<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ORACLE - POSTGRES MIGRATION | Systech Knowledge Base</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Contains the developers knowledge base">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.66c960d3.css" as="style"><link rel="preload" href="/assets/js/app.a5181186.js" as="script"><link rel="preload" href="/assets/js/2.ecabc25e.js" as="script"><link rel="preload" href="/assets/js/14.43674f78.js" as="script"><link rel="prefetch" href="/assets/js/10.d2f16da4.js"><link rel="prefetch" href="/assets/js/11.0896b4de.js"><link rel="prefetch" href="/assets/js/12.a448d99c.js"><link rel="prefetch" href="/assets/js/13.5f7b84be.js"><link rel="prefetch" href="/assets/js/15.8755cab7.js"><link rel="prefetch" href="/assets/js/16.513dd9f4.js"><link rel="prefetch" href="/assets/js/17.1963c9da.js"><link rel="prefetch" href="/assets/js/18.42d50da7.js"><link rel="prefetch" href="/assets/js/19.f5df2a67.js"><link rel="prefetch" href="/assets/js/20.925c4ab6.js"><link rel="prefetch" href="/assets/js/3.a3ba6006.js"><link rel="prefetch" href="/assets/js/4.35578002.js"><link rel="prefetch" href="/assets/js/5.c71a19d6.js"><link rel="prefetch" href="/assets/js/6.8cbc9747.js"><link rel="prefetch" href="/assets/js/7.3fa0e32c.js"><link rel="prefetch" href="/assets/js/8.b1e6084d.js"><link rel="prefetch" href="/assets/js/9.3a2c4e78.js">
    <link rel="stylesheet" href="/assets/css/0.styles.66c960d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://systechafrica.com/wp-content/uploads/2021/03/Overlay-logo.png" alt="Systech Knowledge Base" class="logo"> <span class="site-name can-hide">Systech Knowledge Base</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database Setup" class="dropdown-title"><span class="title">Database Setup</span> <span class="arrow down"></span></button> <button type="button" aria-label="Database Setup" class="mobile-dropdown-title"><span class="title">Database Setup</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database-setup/oracle-guide/" class="nav-link">
  Oracle Database Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/edb-postgres-guide/" class="nav-link">
  EDB Postgres Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/postgres-guide/" class="nav-link">
  Postgres Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/mysql-guide/" class="nav-link">
  Mysql Setup
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevSecOps" class="dropdown-title"><span class="title">DevSecOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="DevSecOps" class="mobile-dropdown-title"><span class="title">DevSecOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/security/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/security/proactive-control/" class="nav-link">
  Proactive Controls
</a></li><li class="dropdown-item"><!----> <a href="/security/ssl-reverse-proxy/" class="nav-link">
  SSL Installation Using Reverse Proxy
</a></li><li class="dropdown-item"><!----> <a href="/security/ssl-letsencrypt/" class="nav-link">
  SSl Installation using self signed certificate from letsencrypt, apache and reverse proxy
</a></li></ul></div></div><div class="nav-item"><a href="/pension-domain/" class="nav-link">
  Pension Domain
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Fundmaster Guide" class="dropdown-title"><span class="title">Fundmaster Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Fundmaster Guide" class="mobile-dropdown-title"><span class="title">Fundmaster Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://documentation.systechafrica.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://knowledgebase.systechafrica.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Knowledge Base
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database Setup" class="dropdown-title"><span class="title">Database Setup</span> <span class="arrow down"></span></button> <button type="button" aria-label="Database Setup" class="mobile-dropdown-title"><span class="title">Database Setup</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database-setup/oracle-guide/" class="nav-link">
  Oracle Database Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/edb-postgres-guide/" class="nav-link">
  EDB Postgres Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/postgres-guide/" class="nav-link">
  Postgres Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/mysql-guide/" class="nav-link">
  Mysql Setup
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevSecOps" class="dropdown-title"><span class="title">DevSecOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="DevSecOps" class="mobile-dropdown-title"><span class="title">DevSecOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/security/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/security/proactive-control/" class="nav-link">
  Proactive Controls
</a></li><li class="dropdown-item"><!----> <a href="/security/ssl-reverse-proxy/" class="nav-link">
  SSL Installation Using Reverse Proxy
</a></li><li class="dropdown-item"><!----> <a href="/security/ssl-letsencrypt/" class="nav-link">
  SSl Installation using self signed certificate from letsencrypt, apache and reverse proxy
</a></li></ul></div></div><div class="nav-item"><a href="/pension-domain/" class="nav-link">
  Pension Domain
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Fundmaster Guide" class="dropdown-title"><span class="title">Fundmaster Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Fundmaster Guide" class="mobile-dropdown-title"><span class="title">Fundmaster Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://documentation.systechafrica.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://knowledgebase.systechafrica.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Knowledge Base
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Database Setup</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database-setup/oracle-guide.html" class="sidebar-link">Oracle Database Setup</a></li><li><a href="/database-setup/edb-postgres-guide.html" class="sidebar-link">EDB Postgres database Setup</a></li><li><a href="/database-setup/postgres-guide.html" aria-current="page" class="active sidebar-link">ORACLE - POSTGRES MIGRATION</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#target" class="sidebar-link">TARGET</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#why" class="sidebar-link">WHY</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#conversion-process" class="sidebar-link">Conversion Process</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#must-have-schemas" class="sidebar-link">MUST HAVE SCHEMAS</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#important-scripts" class="sidebar-link">IMPORTANT SCRIPTS</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#models" class="sidebar-link">MODELS</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#native-queries" class="sidebar-link">NATIVE QUERIES</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#postgres-login-user" class="sidebar-link">POSTGRES LOGIN USER</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#import-db" class="sidebar-link">IMPORT DB</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#run-sql" class="sidebar-link">RUN SQL</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#drop-all-views-sql" class="sidebar-link">DROP ALL VIEWS SQL</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#show-all-tables-in-schema-sql" class="sidebar-link">show ALL tables in schema SQL</a></li></ul></li><li><a href="/database-setup/mysql-guide.html" class="sidebar-link">MYSQL database Setup</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DevSecOps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pension Domain</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="oracle-postgres-migration"><a href="#oracle-postgres-migration" class="header-anchor">#</a> ORACLE - POSTGRES MIGRATION</h1> <h2 id="target"><a href="#target" class="header-anchor">#</a> TARGET</h2> <div class="language- extra-class"><pre class="language-text"><code>To have Fundmaster XE run on PostgreSQL Database 
</code></pre></div><h2 id="why"><a href="#why" class="header-anchor">#</a> WHY</h2> <div class="language- extra-class"><pre class="language-text"><code>    1.Cost: Oracle license costs, using Oracle databases incurs additional costs for features like partitioning and high availability, and expenses can add up quickly. Open-source PostgreSQL is free to install and use.
    2.Flexibility: PostgreSQL has open-source licensing and is easily available from public cloud providers, including AWS. With PostgreSQL, youâ€™re not at risk of vendor lock-in.
    3.Customizability: Because PostgreSQL is open-source, there are countless extensions and add-ons that can improve database performance markedly, and many of them are free to use. With Oracle, similar features quickly add up in cost.
  SOURCE: https://www.enterprisedb.com/blog/the-complete-oracle-to-postgresql-migration-guide-tutorial-move-convert-database-oracle-alternative
</code></pre></div><h4 id="do-we-need-oracle-database-to-postgres-database-migration"><a href="#do-we-need-oracle-database-to-postgres-database-migration" class="header-anchor">#</a> DO WE NEED ORACLE DATABASE TO POSTGRES DATABASE MIGRATION</h4> <div class="language- extra-class"><pre class="language-text"><code>NO. With JPA/HIBERNATE technology, On Installation Fundmaster XE generates tables from entities.
</code></pre></div><h2 id="conversion-process"><a href="#conversion-process" class="header-anchor">#</a> Conversion Process</h2> <div class="language- extra-class"><pre class="language-text"><code>1. Modify Models/Entities to be postgres compatible . Eg using SEQUENCE generation type IDs
   source: https://vladmihalcea.com/jpa-entity-identifier-sequence/
   https://thorben-janssen.com/hibernate-postgresql-5-things-need-know/
   Changing column precision scales from 20 to 16 for Bigdecimals
2. Convert DTOs variables to lower case, postgres converts everything to lower case. Do not use \&quot;xxx\&quot; in sql statements.
3. Replace NVL with coalesce.
4. Replace sysdate() with aws_oracle_ext.sysdate().
5. Cast to BigInteger all select count resultsets and single column results whose datatype is bigint, same to any other datatype else will throw an error.
6. Replace all `hibernate_sequence.nextval` with nextval('hibernate_sequence').
7. Replace list_agg with string_agg.
8. Use appropriate date functions.
9. Check all native queries
10. Cast to BigInteger all select nextval('hibernate_sequence') resultsets
11. All sub-queries must have an alias
12. Use 'yyyy-MM-dd' in to_date() function, and convert all first arguments to string. Use custom function dateformat to achieve this. see examples below
13. Remove force keyword in create view sql

</code></pre></div><h3 id="process"><a href="#process" class="header-anchor">#</a> PROCESS</h3> <ul><li>[x] Set up PostgresSQL Database</li> <li>[x] Set up data sources and persistence</li> <li>[x] Make initial XE deployment</li> <li>[x] Fix the models/entities</li> <li>[x] Redeploy</li> <li>[ ] Migrate Views &amp; Routines</li> <li>[ ] Migrate Native Queries</li> <li>[x] Data Migration, From Oracle cloud to postgres db</li> <li>[ ] Testing</li></ul> <h3 id="webapp-folder"><a href="#webapp-folder" class="header-anchor">#</a> WEBAPP FOLDER</h3> <div class="language- extra-class"><pre class="language-text"><code>-user_doc
-WEB-INF
-XiManual
-backup.txt
template_instructions.txt
</code></pre></div><h1 id="changes-made-in-code"><a href="#changes-made-in-code" class="header-anchor">#</a> CHANGES MADE IN CODE</h1> <h2 id="must-have-schemas"><a href="#must-have-schemas" class="header-anchor">#</a> MUST HAVE SCHEMAS</h2> <div class="language- extra-class"><pre class="language-text"><code>aws_oracle_context
aws_oracle_data
aws_oracle_ext
pg_catalog
</code></pre></div><h2 id="important-scripts"><a href="#important-scripts" class="header-anchor">#</a> IMPORTANT SCRIPTS</h2> <h2 id="models"><a href="#models" class="header-anchor">#</a> MODELS</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
<span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">SEQUENCE</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
<span class="token comment">//@Column(name = &quot;spot_rate&quot;, precision=16,scale=20)</span>
<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;spot_rate&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> spotRate<span class="token punctuation">;</span>

<span class="token comment">//DTO</span>
<span class="token comment">//used BigInteger and Long for Ids, all variables in lowercase for mapping using transformers</span>
</code></pre></div><h2 id="native-queries"><a href="#native-queries" class="header-anchor">#</a> NATIVE QUERIES</h2> <h3 id="update"><a href="#update" class="header-anchor">#</a> UPDATE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- update MEMBERS m set m.EXIT_ID=NULL where m.ID=:memberId and m.EXIT_ID=:exitId and m.MBSHIP_STATUS='ACTIVE';</span>
<span class="token keyword">update</span> MEMBERS m
<span class="token keyword">set</span> EXIT_ID<span class="token operator">=</span><span class="token boolean">NULL</span>
<span class="token keyword">where</span> m<span class="token punctuation">.</span>ID <span class="token operator">=</span> :memberId
  <span class="token operator">and</span> m<span class="token punctuation">.</span>EXIT_ID <span class="token operator">=</span> :exitId
  <span class="token operator">and</span> m<span class="token punctuation">.</span>MBSHIP_STATUS <span class="token operator">=</span> <span class="token string">'ACTIVE'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="select"><a href="#select" class="header-anchor">#</a> SELECT</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select m.MBSHIP_STATUS status, mb.GENDER gender from members m INNER JOIN MEMBERS_BIOS mb on m.MEMBERBIO_ID = mb.ID where m.ID=7165;</span>
<span class="token keyword">select</span> m<span class="token punctuation">.</span>MBSHIP_STATUS <span class="token keyword">AS</span> <span class="token keyword">status</span><span class="token punctuation">,</span> mb<span class="token punctuation">.</span>GENDER <span class="token keyword">AS</span> gender
<span class="token keyword">from</span> members m
         <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> MEMBERS_BIOS mb <span class="token keyword">on</span> m<span class="token punctuation">.</span>MEMBERBIO_ID <span class="token operator">=</span> mb<span class="token punctuation">.</span>ID
<span class="token keyword">where</span> m<span class="token punctuation">.</span>ID <span class="token operator">=</span> <span class="token number">7165</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hibernate-sequence"><a href="#hibernate-sequence" class="header-anchor">#</a> hibernate sequence</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> nextval<span class="token punctuation">(</span><span class="token string">'hibernate_sequence'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="add-months"><a href="#add-months" class="header-anchor">#</a> ADD MONTHS</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> add_months<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="months-between"><a href="#months-between" class="header-anchor">#</a> MONTHS BETWEEN</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select months_between(:startPeriod,sysdate) </span>
<span class="token keyword">select</span> DATE_PART<span class="token punctuation">(</span><span class="token string">'year'</span><span class="token punctuation">,</span> :startPeriod::<span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token operator">-</span> DATE_PART<span class="token punctuation">(</span><span class="token string">'year'</span><span class="token punctuation">,</span> <span class="token keyword">current_timestamp</span>::<span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token comment">--Returns number of Years</span>
           <span class="token keyword">use</span> months_between<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token keyword">function</span>
Eg <span class="token keyword">select</span> months_between<span class="token punctuation">(</span><span class="token string">'2022-07-29 05:14:48'</span>::<span class="token keyword">date</span><span class="token punctuation">,</span><span class="token keyword">current_date</span>::<span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="date-time"><a href="#date-time" class="header-anchor">#</a> DATE TIME</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- SELECT sysdate</span>
<span class="token keyword">select</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> aws_oracle_ext<span class="token punctuation">.</span>sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="to-date"><a href="#to-date" class="header-anchor">#</a> TO_DATE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'2021-08-26'</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="date-diff-in-days"><a href="#date-diff-in-days" class="header-anchor">#</a> DATE DIFF IN DAYS</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">current_date</span> <span class="token operator">-</span> <span class="token string">'2021-08-01'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> dys<span class="token punctuation">;</span>
<span class="token keyword">select</span> daterange_subdiff<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">,</span> <span class="token string">'2021-08-01'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> dys<span class="token punctuation">;</span>
</code></pre></div><h3 id="last-day"><a href="#last-day" class="header-anchor">#</a> LAST_DAY</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- Created custom function last_day(date)</span>
<span class="token keyword">use</span>
<span class="token keyword">select</span> last_day<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="rownum"><a href="#rownum" class="header-anchor">#</a> ROWNUM</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select  ROWNUM FROM MEMBERS m;</span>
<span class="token keyword">select</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> m<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> MEMBERS m<span class="token punctuation">;</span>
<span class="token comment">-- select  ROWNUM FROM MEMBERS m where rownum=1;</span>
<span class="token keyword">select</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> m<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> MEMBERS m
<span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="nvl"><a href="#nvl" class="header-anchor">#</a> NVL</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select nvl(c.ee, 0);</span>
<span class="token keyword">select</span> <span class="token keyword">coalesce</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>ee<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="instr"><a href="#instr" class="header-anchor">#</a> INSTR</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select INSTR('xxx.xxx', '.');</span>
<span class="token keyword">select</span> position<span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">in</span> <span class="token string">'xxx.xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="lob"><a href="#lob" class="header-anchor">#</a> Lob</h3> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">//add @Type for postgres to know what type of lob ie ImageType/TextType etc</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token annotation punctuation">@Type</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;org.hibernate.type.TextType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="describe-table"><a href="#describe-table" class="header-anchor">#</a> DESCRIBE TABLE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> table_name<span class="token punctuation">,</span> column_name<span class="token punctuation">,</span> data_type
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span>
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'members'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="list-all-procedures"><a href="#list-all-procedures" class="header-anchor">#</a> List all procedures</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> n<span class="token punctuation">.</span>nspname <span class="token keyword">as</span> <span class="token keyword">schema</span><span class="token punctuation">,</span>
       p<span class="token punctuation">.</span>proname <span class="token keyword">as</span> <span class="token keyword">procedure</span>
<span class="token keyword">from</span> pg_proc p
         <span class="token keyword">join</span> pg_namespace n <span class="token keyword">on</span> p<span class="token punctuation">.</span>pronamespace <span class="token operator">=</span> n<span class="token punctuation">.</span>oid
<span class="token keyword">where</span> n<span class="token punctuation">.</span>nspname <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'pg_catalog'</span><span class="token punctuation">,</span> <span class="token string">'information_schema'</span><span class="token punctuation">)</span>
  <span class="token operator">and</span> p<span class="token punctuation">.</span>prokind <span class="token operator">=</span> <span class="token string">'p'</span>
</code></pre></div><h3 id="format-date"><a href="#format-date" class="header-anchor">#</a> FORMAT DATE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> TO_CHAR<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span> :: <span class="token keyword">DATE</span><span class="token punctuation">,</span> <span class="token string">'Mon dd, yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> todate<span class="token punctuation">(</span><span class="token keyword">current_date</span>::<span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'30-Sep-2021'</span><span class="token punctuation">,</span> <span class="token string">'dd-Mon-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> todate<span class="token punctuation">(</span>to_char<span class="token punctuation">(</span><span class="token string">'2021-09-30'</span>::<span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token string">'dd-MON-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> todate<span class="token punctuation">(</span><span class="token string">'30-Sep-2021'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> dateformat<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_date<span class="token punctuation">(</span>to_char<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token string">'dd-Mon-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'dd-Mon-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'2020-08-30'</span>::<span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token string">'dd-Mon-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> todate<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> date_trunc<span class="token punctuation">(</span><span class="token string">'month'</span><span class="token punctuation">,</span> <span class="token keyword">current_date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> todate<span class="token punctuation">(</span>date_trunc<span class="token punctuation">(</span><span class="token string">'month'</span><span class="token punctuation">,</span> <span class="token keyword">current_date</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_timestamp<span class="token punctuation">(</span><span class="token string">'2022-01-01'</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="error"><a href="#error" class="header-anchor">#</a> ERROR</h3> <ul><li>[x] NonUniqueDiscoveredSqlAliasException: Encountered a duplicated sql alias
<code>sql has more than one column with same name, introduce alias</code></li> <li>[x] Could not resolve PropertyAccess for dateAcquired on class com.systech.fm.dto.accounts.FixedAssetsDto
<code>Find the attribute in the DTO and change to lowercase</code></li></ul> <h2 id="postgres-login-user"><a href="#postgres-login-user" class="header-anchor">#</a> POSTGRES LOGIN USER</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>psql <span class="token parameter variable">-U</span> posgres
<span class="token builtin class-name">pwd</span> <span class="token punctuation">[</span>postgres<span class="token punctuation">]</span>
psql <span class="token parameter variable">-V</span> psql <span class="token punctuation">[</span> psql <span class="token punctuation">(</span>PostgreSQL<span class="token punctuation">)</span> <span class="token number">12.6</span> <span class="token punctuation">]</span>
</code></pre></div><h2 id="import-db"><a href="#import-db" class="header-anchor">#</a> IMPORT DB</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pg_restore <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">--dbname</span><span class="token operator">=</span>fm <span class="token parameter variable">--create</span> <span class="token parameter variable">--verbose</span> c:<span class="token punctuation">\</span>pgbackup<span class="token punctuation">\</span>fm.tar
</code></pre></div><h2 id="run-sql"><a href="#run-sql" class="header-anchor">#</a> RUN SQL</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#LOGIN TO PSQL</span>
<span class="token punctuation">\</span>i path_to_sql_file
</code></pre></div><h1 id="import-million-records-faster"><a href="#import-million-records-faster" class="header-anchor">#</a> IMPORT MILLION RECORDS FASTER</h1> <div class="language-postgresql extra-class"><pre class="language-text"><code>create table peopleNames
(
    name  varchar(255),
    sex   varchar(255),
    sex_1 varchar(255),
    count bigint,
    year  bigint
);
--FROM TERMINAL
COPY peopleNames FROM '/path/to/pp-complete.csv' with (format csv, encoding 'utf-8', header false, null '', quote '&quot;');
</code></pre></div><h1 id="split-delimited-string"><a href="#split-delimited-string" class="header-anchor">#</a> SPLIT DELIMITED STRING</h1> <div class="language-postgresql extra-class"><pre class="language-text"><code>select unnest(string_to_array('1,2,3,4,5', ',')) as id;
--or
SELECT regexp_split_to_table('1,2,3,4,5', ',') AS ID;
--https://medium.com/swlh/three-routes-convert-comma-separated-column-to-rows-c17c85079ecf
</code></pre></div><h2 id="drop-all-views-sql"><a href="#drop-all-views-sql" class="header-anchor">#</a> DROP ALL VIEWS SQL</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token string">'DROP VIEW '</span> <span class="token operator">||</span> <span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">' cascade;'</span>
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>views
<span class="token keyword">WHERE</span> table_schema <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--copy and save to file and execute</span>
</code></pre></div><h2 id="show-all-tables-in-schema-sql"><a href="#show-all-tables-in-schema-sql" class="header-anchor">#</a> show ALL tables in schema SQL</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> table_name
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span>
<span class="token keyword">WHERE</span> table_schema <span class="token operator">=</span> <span class="token string">'public'</span>
  <span class="token operator">and</span> table_name <span class="token operator">like</span> <span class="token string">'act_%'</span><span class="token punctuation">;</span>
<span class="token comment">----------------------------</span>
<span class="token keyword">SELECT</span> <span class="token string">'DROP TABLE '</span> <span class="token operator">||</span> <span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">' cascade;'</span> <span class="token keyword">as</span> qry
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span>
<span class="token keyword">WHERE</span> table_schema <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span>
  <span class="token operator">and</span> table_name <span class="token operator">like</span> <span class="token string">'act_%'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="important-scripts-2"><a href="#important-scripts-2" class="header-anchor">#</a> IMPORTANT SCRIPTS</h4> <div class="language-sql extra-class"><pre class="language-sql"><code>
<span class="token keyword">ALTER</span> SEQUENCE hibernate_sequence RESTART <span class="token keyword">WITH</span> <span class="token number">12879141</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> VIEW_NAME<span class="token punctuation">,</span> OWNER
<span class="token keyword">from</span> all_views
<span class="token keyword">where</span> OWNER <span class="token operator">=</span> <span class="token string">'FM'</span><span class="token punctuation">;</span> <span class="token comment">--ORACLE DB</span>

<span class="token keyword">select</span> viewname
<span class="token keyword">from</span> pg_catalog<span class="token punctuation">.</span>pg_views
<span class="token keyword">where</span> schemaname <span class="token operator">=</span> <span class="token string">'public'</span><span class="token punctuation">;</span> <span class="token comment">--get all views in schema</span>

<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>viewname<span class="token punctuation">)</span>
<span class="token keyword">from</span> pg_catalog<span class="token punctuation">.</span>pg_views
<span class="token keyword">where</span> schemaname <span class="token operator">=</span> <span class="token string">'public'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> pg_terminate_backend<span class="token punctuation">(</span>pg_stat_activity<span class="token punctuation">.</span>pid<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> pg_stat_activity
<span class="token keyword">WHERE</span> pg_stat_activity<span class="token punctuation">.</span>datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> pg_stat_activity
<span class="token keyword">WHERE</span> datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> datname
<span class="token keyword">FROM</span> pg_database<span class="token punctuation">;</span><span class="token comment">--get database names</span>

<span class="token keyword">DELETE</span>
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_database
<span class="token keyword">WHERE</span> datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_tables
<span class="token keyword">WHERE</span> schemaname <span class="token operator">!=</span> <span class="token string">'pg_catalog'</span>
  <span class="token operator">AND</span> schemaname <span class="token operator">!=</span> <span class="token string">'information_schema'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> tablename
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_tables
<span class="token keyword">WHERE</span> schemaname <span class="token operator">!=</span> <span class="token string">'pg_catalog'</span>
  <span class="token operator">AND</span> schemaname <span class="token operator">!=</span> <span class="token string">'information_schema'</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="installing-an-extension"><a href="#installing-an-extension" class="header-anchor">#</a> INSTALLING AN EXTENSION</h1> <div class="language- extra-class"><pre class="language-text"><code>   We will be installing tsm_system_rows extension for quick randomizing rows in a table.
   1.   Download postgres source from [https://www.postgresql.org/ftp/source/]
   2.   Unzip and cd to folder.
   3.   bash# sudo ./configure --without-readline --with-pgconfig=/usr/pgsql-14/bin/pg_config
   4.   bash# make
   5.   cd ./contrib/tsm_system_rows/
   6.   bash# sudo make install
   7.   We need to know where to paste the output, run (CREATE EXTENSION tsm_system_rows;) and note the error path
   8.   Copy tsm_system_rows--1.0.sql &amp; tsm_system_rows.control to [/usr/pgsql-14/share/extension]
   9.   Copy tsm_system_rows.so to [/usr/pgsql-14/lib]
   10.  Lauch psql shell [psql -U postgres]
   11.  psql# create extension tsm_system_rows;
   12.  Test psql# SELECT * FROM my_table TABLESAMPLE SYSTEM_ROWS(100);
   
   Installing pg_cron extension
    git clone https://github.com/citusdata/pg_cron.git
    cd pg_cron
    # Ensure pg_config is in your path, e.g.
    export PATH=/usr/pgsql-11/bin:$PATH
    make &amp;&amp; sudo PATH=$PATH make install
</code></pre></div><h4 id="important-scripts-3"><a href="#important-scripts-3" class="header-anchor">#</a> IMPORTANT SCRIPTS</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token string">'alter table '</span> <span class="token operator">||</span> owner <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> table_name <span class="token operator">||</span> <span class="token string">' disable constraint '</span> <span class="token operator">||</span> constraint_name <span class="token operator">||</span> <span class="token string">';'</span>
<span class="token keyword">from</span> user_constraints<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token string">'alter table '</span> <span class="token operator">||</span> owner <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> table_name <span class="token operator">||</span> <span class="token string">' enable constraint '</span> <span class="token operator">||</span> constraint_name <span class="token operator">||</span> <span class="token string">';'</span>
<span class="token keyword">from</span> user_constraints<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> pg_terminate_backend<span class="token punctuation">(</span>pg_stat_activity<span class="token punctuation">.</span>pid<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> pg_stat_activity
<span class="token keyword">WHERE</span> pg_stat_activity<span class="token punctuation">.</span>datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> pg_stat_activity
<span class="token keyword">WHERE</span> datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> datname
<span class="token keyword">FROM</span> pg_database<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span>
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_database
<span class="token keyword">WHERE</span> datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_tables
<span class="token keyword">WHERE</span> schemaname <span class="token operator">!=</span> <span class="token string">'pg_catalog'</span>
  <span class="token operator">AND</span> schemaname <span class="token operator">!=</span> <span class="token string">'information_schema'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> tablename
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_tables
<span class="token keyword">WHERE</span> schemaname <span class="token operator">!=</span> <span class="token string">'pg_catalog'</span>
  <span class="token operator">AND</span> schemaname <span class="token operator">!=</span> <span class="token string">'information_schema'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="alter-table-columns"><a href="#alter-table-columns" class="header-anchor">#</a> ALTER TABLE COLUMNS</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">with</span> mitables
         <span class="token keyword">as</span> <span class="token punctuation">(</span><span class="token keyword">select</span> unnest<span class="token punctuation">(</span>ARRAY <span class="token punctuation">[</span><span class="token string">'closing_balances'</span><span class="token punctuation">,</span><span class="token string">'BENEFITS'</span><span class="token punctuation">,</span><span class="token string">'BENEFIT_PAYMENTS'</span><span class="token punctuation">,</span><span class="token string">'PROV_BEN_BAL'</span><span class="token punctuation">,</span><span class="token string">'FUND_VALUES'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tb<span class="token punctuation">)</span>
<span class="token keyword">select</span> <span class="token string">'alter table '</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">select</span> tb <span class="token keyword">from</span> mitables <span class="token keyword">where</span> lower<span class="token punctuation">(</span>tb<span class="token punctuation">)</span> <span class="token operator">=</span> table_name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">' alter column '</span> <span class="token operator">||</span> column_name <span class="token operator">||</span>
       <span class="token string">' type numeric(19,10);'</span>
<span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span>
<span class="token keyword">where</span> table_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> lower<span class="token punctuation">(</span>tb<span class="token punctuation">)</span> <span class="token keyword">from</span> mitables<span class="token punctuation">)</span>
  <span class="token operator">and</span> data_type <span class="token operator">=</span> <span class="token string">'numeric'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span>
<span class="token keyword">where</span> table_name <span class="token operator">=</span> <span class="token string">'closing_balances'</span>
  <span class="token operator">and</span> data_type <span class="token operator">=</span> <span class="token string">'numeric'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token string">'update closing_balances set '</span> <span class="token operator">||</span> column_name <span class="token operator">||</span> <span class="token string">'=0 where '</span> <span class="token operator">||</span> column_name <span class="token operator">||</span> <span class="token string">' is null and id=1283097;'</span>
<span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span>
<span class="token keyword">where</span> table_name <span class="token operator">=</span> <span class="token string">'closing_balances'</span>
  <span class="token operator">and</span> data_type <span class="token operator">=</span> <span class="token string">'numeric'</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h1 id="reset-db-notifications"><a href="#reset-db-notifications" class="header-anchor">#</a> RESET DB NOTIFICATIONS</h1> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> MEMBERS_BIOS <span class="token keyword">set</span> EMAIL<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> USERS <span class="token keyword">set</span> EMAIL<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> SPONSORS
<span class="token keyword">set</span> EMAIL<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> PRINCIPAL_OFFICERS
<span class="token keyword">set</span> EMAIL <span class="token operator">=</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> BENEFICIARIES
<span class="token keyword">set</span> EMAIL <span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span>
<span class="token keyword">from</span> mails<span class="token punctuation">;</span>
<span class="token keyword">Update</span> minors
<span class="token keyword">set</span> email <span class="token operator">=</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span>
<span class="token keyword">from</span> smslist_conf<span class="token punctuation">;</span>
<span class="token keyword">delete</span>
<span class="token keyword">from</span> smses<span class="token punctuation">;</span>
</code></pre></div><hr> <h1 id="backup"><a href="#backup" class="header-anchor">#</a> BACKUP</h1> <div class="language-bash extra-class"><pre class="language-bash"><code>Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> testdb <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token operator">&gt;</span> dump<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>.sql
		pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> fundmaster <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token operator">&gt;</span> backup/fundmaster<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>.sql
Import	<span class="token builtin class-name">:</span>	psql <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> xe <span class="token parameter variable">-a</span> <span class="token parameter variable">-f</span> myInsertFile
		<span class="token punctuation">\</span>i dump.sql

Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> xe <span class="token parameter variable">-v</span> <span class="token parameter variable">--format</span><span class="token operator">=</span>t <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">--encoding</span><span class="token operator">=</span>UTF-8 <span class="token operator">&gt;</span> dump<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>.tar
Import	<span class="token builtin class-name">:</span>	pg_restore <span class="token parameter variable">-c</span> <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> pacific <span class="token parameter variable">-v</span> ./aws-schemas.tar <span class="token parameter variable">-W</span>

		-- Large Databases
Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-U</span> username <span class="token parameter variable">-j</span> num <span class="token parameter variable">-F</span> d <span class="token parameter variable">-f</span> out.dir dbname <span class="token parameter variable">-v</span>
		pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">10</span> <span class="token parameter variable">-F</span> d <span class="token parameter variable">-f</span> ./nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span> nassitdb <span class="token parameter variable">-v</span>
Import	<span class="token builtin class-name">:</span>	pg_restore <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">10</span> <span class="token parameter variable">-d</span> nassitdb ./nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span> <span class="token parameter variable">-v</span>

Export	<span class="token builtin class-name">:</span>	pg_dump dbname <span class="token operator">|</span> <span class="token function">gzip</span> <span class="token operator">&gt;</span> filename.gz
Import	<span class="token builtin class-name">:</span>	gunzip <span class="token parameter variable">-c</span> filename.gz <span class="token operator">|</span> psql dbname

Export	<span class="token builtin class-name">:</span>	pg_dump dbname <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 2G - filename
Import	<span class="token builtin class-name">:</span>	<span class="token function">cat</span> filename* <span class="token operator">|</span> psql dbname

Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-Fc</span> dbname <span class="token operator">&gt;</span> filename
Import	<span class="token builtin class-name">:</span>	pg_restore <span class="token parameter variable">-d</span> dbname filename

		-- Large Databases
Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-U</span> username <span class="token parameter variable">-v</span> <span class="token parameter variable">-Fc</span> dbname <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 2G - filename
		pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-v</span> <span class="token parameter variable">-Fc</span> nassitdb <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 5G - nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>
Import	<span class="token builtin class-name">:</span>	pg_restore <span class="token parameter variable">-j</span> <span class="token number">8</span> <span class="token parameter variable">-d</span> dbname filename <span class="token parameter variable">-v</span>
</code></pre></div><p>Favourite Commands</p> <div class="language-bash extra-class"><pre class="language-bash"><code>-- Fast
pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">10</span> <span class="token parameter variable">-F</span> d <span class="token parameter variable">-f</span> ./nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span> nassitdb <span class="token parameter variable">-v</span>
pg_restore <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">8</span> <span class="token parameter variable">-d</span> nassitdb ./nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span> <span class="token parameter variable">-v</span>

-- Slower
pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-v</span> <span class="token parameter variable">-Fc</span> nassitdb <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 5G - nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>
pg_restore <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">8</span> <span class="token parameter variable">-d</span> nassitdb nassitdump <span class="token parameter variable">-v</span>
</code></pre></div><p>Remote Connection</p> <div class="language-bash extra-class"><pre class="language-bash"><code>psql <span class="token parameter variable">-h</span> <span class="token number">3.7</span>.212.215 <span class="token parameter variable">-p</span> <span class="token number">5432</span> <span class="token parameter variable">-d</span> fundmaster <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-W</span> 
</code></pre></div><hr> <h1 id="streaming-replication-v14"><a href="#streaming-replication-v14" class="header-anchor">#</a> STREAMING REPLICATION v14</h1> <hr> <p>We need 2 servers i.e Master &amp; Slave.</p> <h3 id="_1-master-server"><a href="#_1-master-server" class="header-anchor">#</a> 1. MASTER SERVER</h3> <p>Create Replication user</p> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token keyword">CREATE</span> ROLE replicator <span class="token keyword">WITH</span> LOGIN NOSUPERUSER NOCREATEDB NOCREATEROLE NOINHERIT <span class="token keyword">REPLICATION</span> CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span> PASSWORD <span class="token string">'Qwerty123'</span><span class="token punctuation">;</span>
</code></pre></div><p>Edit <span style="color:yellow;"><i>postgresql.conf</i></span></p><blockquote>
wal_level = replica <br>
max_wal_senders = 100
</blockquote>
Edit <span style="color:yellow;"><i>pg_hba.conf</i></span> <blockquote>
host replication all <span style="color:deepskyblue;">slave_ip_address/32 </span> trust <br>
host replication replicator <span style="color:deepskyblue;">slave_ip_address/32 </span> trust
</blockquote>
Restart the postgres service.<p></p> <h3 id="_2-slave-server"><a href="#_2-slave-server" class="header-anchor">#</a> 2. SLAVE SERVER</h3> <blockquote>
Create a directory. <br> <code>
    mkdir /app/postgresql/pgdatabase/data
  </code> <br></blockquote> <blockquote> 
Now transfer data from master to slave.  <br> <code>
 pg_basebackup -h <span style="color:yellow;">master_ip</span> -U replicator -D /app/postgresql/pgdatabase/data --write-recovery-conf --progress --verbose
 </code></blockquote> <blockquote> 
Assign the postgres owner of all migrated directories  <br> <code>
  chmod -R 0700 /app/postgresql/pgdatabase/data 
</code></blockquote> <blockquote> 
Launching a replica and checking the replication status.  <br> <code>pg_ctl start /app/postgresql/pgdatabase/data</code> <br>
How to stop stop
 <code>pg_ctl -D /var/lib/pgsql/9.6/data -m immediate stop</code> <br> <p>If error change permissions as below
</p></blockquote> <blockquote>
Change directory user and group.  <br> <code>
chown <span style="color:deepskyblue;">user</span> <span style="color:#77bc71;">/var/run/folderName</span></code> <code><br>
chgrp <span style="color:deepskyblue;">user</span> <span style="color:#77bc71;">/var/run/folderName</span></code></blockquote><p></p> <h3 id="confirm"><a href="#confirm" class="header-anchor">#</a> CONFIRM</h3> <p>On the Master Server run :</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> application_name<span class="token punctuation">,</span> state<span class="token punctuation">,</span> sent_lsn<span class="token punctuation">,</span> write_lsn<span class="token punctuation">,</span>  sync_state <span class="token keyword">from</span> pg_stat_replication<span class="token punctuation">;</span>
</code></pre></div><hr> <h1 id="good-practices"><a href="#good-practices" class="header-anchor">#</a> Good practices</h1> <div class="language- extra-class"><pre><code>[https://stackoverflow.com/questions/45782327/org-postgresql-util-psqlexception-error-column-user0-id-does-not-exist-hibe](https://stackoverflow.com/questions/45782327/org-postgresql-util-psqlexception-error-column-user0-id-does-not-exist-hibe)
</code></pre></div><p>1 Don't use Upper letters in the name of database, schema, tables or columns in PostgreSQL. Else you should to escape
this names with quotes, and this can cause Syntax errors, so instead you can use :</p> <div class="language- extra-class"><pre><code>    @Table(name=&quot;table_name&quot;, schema = &quot;schame_name&quot;)
    ^^^^^^^^^^             ^^^^^^^^^^^
</code></pre></div><p>2 the keyword USER is reserved keyword in PostgreSQL take a look at</p> <div class="language- extra-class"><pre><code>**+----------+-----------+----------+-----------+---------+
| Key Word |PostgreSQL |SQL:2003  | SQL:1999  | SQL-92  |
+----------+-----------+----------+-----------+---------+
|  ....        ....       ....       ....       ....    |
+----------+-----------+----------+-----------+---------+
| USER     |  reserved |reserved  | reserved  | reserved|**
+----------+-----------+----------+-----------+---------+
</code></pre></div><p>3 To difference between Dto and Entity its good practice to use Entity in the end of the name of your Entity for example
UserEntity</p> <h1 id="important-links"><a href="#important-links" class="header-anchor">#</a> IMPORTANT LINKS</h1> <p>https://www.postgresqltutorial.com/
<a href="https://postgrescheatsheet.com/#/tables" target="_blank" rel="noopener noreferrer">https://postgrescheatsheet.com/#/tables<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://medium.com/coding-blocks/creating-user-database-and-adding-access-on-postgresql-8bfcd2f4a91e" target="_blank" rel="noopener noreferrer">https://medium.com/coding-blocks/creating-user-database-and-adding-access-on-postgresql-8bfcd2f4a91e<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
https://www.postgresqltutorial.com/postgresql-reset-password/</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/22/2023, 10:13:06 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/database-setup/edb-postgres-guide.html" class="prev">
        EDB Postgres database Setup
      </a></span> <span class="next"><a href="/database-setup/mysql-guide.html">
        MYSQL database Setup
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a5181186.js" defer></script><script src="/assets/js/2.ecabc25e.js" defer></script><script src="/assets/js/14.43674f78.js" defer></script>
  </body>
</html>
