<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ORACLE - POSTGRES MIGRATION | Systech Knowledge Base</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Contains the developers knowledge base">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.66c960d3.css" as="style"><link rel="preload" href="/assets/js/app.0205bbfe.js" as="script"><link rel="preload" href="/assets/js/2.51e18b29.js" as="script"><link rel="preload" href="/assets/js/19.4f877263.js" as="script"><link rel="prefetch" href="/assets/js/10.6b98b1dc.js"><link rel="prefetch" href="/assets/js/11.478366af.js"><link rel="prefetch" href="/assets/js/12.716738f3.js"><link rel="prefetch" href="/assets/js/13.f83ab192.js"><link rel="prefetch" href="/assets/js/14.e07c8418.js"><link rel="prefetch" href="/assets/js/15.ce78e2a0.js"><link rel="prefetch" href="/assets/js/16.55c1e4fd.js"><link rel="prefetch" href="/assets/js/17.06c94d70.js"><link rel="prefetch" href="/assets/js/18.68117253.js"><link rel="prefetch" href="/assets/js/20.4ab5ba82.js"><link rel="prefetch" href="/assets/js/21.d8c952ba.js"><link rel="prefetch" href="/assets/js/22.88a36e8d.js"><link rel="prefetch" href="/assets/js/23.22746895.js"><link rel="prefetch" href="/assets/js/24.aa7a348b.js"><link rel="prefetch" href="/assets/js/25.b922b1c0.js"><link rel="prefetch" href="/assets/js/26.c221d840.js"><link rel="prefetch" href="/assets/js/27.a51ed0f8.js"><link rel="prefetch" href="/assets/js/28.df2e163a.js"><link rel="prefetch" href="/assets/js/29.a4b832c4.js"><link rel="prefetch" href="/assets/js/3.c63690de.js"><link rel="prefetch" href="/assets/js/30.5a023ff9.js"><link rel="prefetch" href="/assets/js/4.57767f75.js"><link rel="prefetch" href="/assets/js/5.d48d4777.js"><link rel="prefetch" href="/assets/js/6.982869b1.js"><link rel="prefetch" href="/assets/js/7.37372ca8.js"><link rel="prefetch" href="/assets/js/8.1fdb41cb.js"><link rel="prefetch" href="/assets/js/9.ddabfbb1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.66c960d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://systechafrica.com/wp-content/uploads/2021/03/Overlay-logo.png" alt="Systech Knowledge Base" class="logo"> <span class="site-name can-hide">Systech Knowledge Base</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database Setup" class="dropdown-title"><span class="title">Database Setup</span> <span class="arrow down"></span></button> <button type="button" aria-label="Database Setup" class="mobile-dropdown-title"><span class="title">Database Setup</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database-setup/oracle-guide/" class="nav-link">
  Oracle Database Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/edb-postgres-guide/" class="nav-link">
  EDB Postgres Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/postgres-guide/" class="nav-link">
  Postgres Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/mysql-guide/" class="nav-link">
  Mysql Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/triggers/" class="nav-link">
  Track Database Changes
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/warehouse-readme/" class="nav-link">
  Warehouse Database
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevSecOps" class="dropdown-title"><span class="title">DevSecOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="DevSecOps" class="mobile-dropdown-title"><span class="title">DevSecOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/security/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/security/proactive-control/" class="nav-link">
  Proactive Controls
</a></li><li class="dropdown-item"><!----> <a href="/security/ssl-reverse-proxy/" class="nav-link">
  SSL Installation Using Reverse Proxy
</a></li><li class="dropdown-item"><!----> <a href="/security/ssl-letsencrypt/" class="nav-link">
  SSl Installation using self signed certificate from letsencrypt, apache and reverse proxy
</a></li></ul></div></div><div class="nav-item"><a href="/pension-domain/" class="nav-link">
  Pension Domain
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Fundmaster Guide" class="dropdown-title"><span class="title">Fundmaster Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Fundmaster Guide" class="mobile-dropdown-title"><span class="title">Fundmaster Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://documentation.systechafrica.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://knowledgebase.systechafrica.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Knowledge Base
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database Setup" class="dropdown-title"><span class="title">Database Setup</span> <span class="arrow down"></span></button> <button type="button" aria-label="Database Setup" class="mobile-dropdown-title"><span class="title">Database Setup</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database-setup/oracle-guide/" class="nav-link">
  Oracle Database Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/edb-postgres-guide/" class="nav-link">
  EDB Postgres Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/postgres-guide/" class="nav-link">
  Postgres Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/mysql-guide/" class="nav-link">
  Mysql Setup
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/triggers/" class="nav-link">
  Track Database Changes
</a></li><li class="dropdown-item"><!----> <a href="/database-setup/warehouse-readme/" class="nav-link">
  Warehouse Database
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevSecOps" class="dropdown-title"><span class="title">DevSecOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="DevSecOps" class="mobile-dropdown-title"><span class="title">DevSecOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/security/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/security/proactive-control/" class="nav-link">
  Proactive Controls
</a></li><li class="dropdown-item"><!----> <a href="/security/ssl-reverse-proxy/" class="nav-link">
  SSL Installation Using Reverse Proxy
</a></li><li class="dropdown-item"><!----> <a href="/security/ssl-letsencrypt/" class="nav-link">
  SSl Installation using self signed certificate from letsencrypt, apache and reverse proxy
</a></li></ul></div></div><div class="nav-item"><a href="/pension-domain/" class="nav-link">
  Pension Domain
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Fundmaster Guide" class="dropdown-title"><span class="title">Fundmaster Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Fundmaster Guide" class="mobile-dropdown-title"><span class="title">Fundmaster Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://documentation.systechafrica.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://knowledgebase.systechafrica.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Knowledge Base
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Database Setup</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database-setup/oracle-guide.html" class="sidebar-link">Oracle Database Setup</a></li><li><a href="/database-setup/edb-postgres-guide.html" class="sidebar-link">EDB Postgres database Setup</a></li><li><a href="/database-setup/postgres-guide.html" aria-current="page" class="active sidebar-link">ORACLE - POSTGRES MIGRATION</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#target" class="sidebar-link">Target</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#why" class="sidebar-link">Why</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#conversion-process" class="sidebar-link">Conversion Process</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#changes-made-in-code" class="sidebar-link">Changes Made In Code</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#native-queries" class="sidebar-link">Native Queries</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#login-user" class="sidebar-link">Login User</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#import-database" class="sidebar-link">Import Database</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#run-sql" class="sidebar-link">Run SQL</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#import-million-records-faster" class="sidebar-link">Import Million Records Faster</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#split-delimited-string" class="sidebar-link">Split Delimited String</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#drop-all-views" class="sidebar-link">Drop All Views</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#show-all-tables-in-schema" class="sidebar-link">Show All Tables In Schema</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#important-scripts" class="sidebar-link">Important Scripts</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#installing-extension" class="sidebar-link">Installing Extension</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#database-queries" class="sidebar-link">Database Queries</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#alter-table-columns" class="sidebar-link">Alter Table Columns</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#reset-database-notifications" class="sidebar-link">Reset Database Notifications</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#backup" class="sidebar-link">Backup</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#remote-connection" class="sidebar-link">Remote Connection</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#creating-a-cluster" class="sidebar-link">Creating A Cluster</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#streaming-replication-v14" class="sidebar-link">Streaming Replication v14</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#master-to-master-replication-v16" class="sidebar-link">Master-to-Master Replication v16</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#load-balancing" class="sidebar-link">Load Balancing</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#failover-failback" class="sidebar-link">Failover &amp; Failback</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#connection-pooling" class="sidebar-link">Connection Pooling</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#performance-testing" class="sidebar-link">Performance Testing</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#good-practices" class="sidebar-link">Good practices</a></li><li class="sidebar-sub-header"><a href="/database-setup/postgres-guide.html#important-links" class="sidebar-link">Important Links</a></li></ul></li><li><a href="/database-setup/mysql-guide.html" class="sidebar-link">MYSQL database Setup</a></li><li><a href="/database-setup/triggers.html" class="sidebar-link">Track Database Table Changes</a></li><li><a href="/database-setup/warehouse-readme.html" class="sidebar-link">Warehouse Database 🚀️</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Backups Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DevSecOps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pension Domain</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="oracle-postgres-migration"><a href="#oracle-postgres-migration" class="header-anchor">#</a> ORACLE - POSTGRES MIGRATION</h1> <h2 id="target"><a href="#target" class="header-anchor">#</a> Target</h2> <div class="language- extra-class"><pre class="language-text"><code>To have Fundmaster XE run on PostgreSQL Database 
</code></pre></div><h2 id="why"><a href="#why" class="header-anchor">#</a> Why</h2> <div class="language- extra-class"><pre class="language-text"><code>    1.Cost: Oracle license costs, using Oracle databases incurs additional costs for features like partitioning and high availability, and expenses can add up quickly. Open-source PostgreSQL is free to install and use.
    2.Flexibility: PostgreSQL has open-source licensing and is easily available from public cloud providers, including AWS. With PostgreSQL, you’re not at risk of vendor lock-in.
    3.Customizability: Because PostgreSQL is open-source, there are countless extensions and add-ons that can improve database performance markedly, and many of them are free to use. With Oracle, similar features quickly add up in cost.
  SOURCE: https://www.enterprisedb.com/blog/the-complete-oracle-to-postgresql-migration-guide-tutorial-move-convert-database-oracle-alternative
</code></pre></div><h4 id="do-we-need-oracle-database-to-postgres-database-migration"><a href="#do-we-need-oracle-database-to-postgres-database-migration" class="header-anchor">#</a> Do we need Oracle database to Postgres database migration</h4> <div class="language-text extra-class"><pre class="language-text"><code>NO. With JPA/HIBERNATE technology, On Installation Fundmaster XE generates tables from entities.
</code></pre></div><h2 id="conversion-process"><a href="#conversion-process" class="header-anchor">#</a> Conversion Process</h2> <div class="language-text extra-class"><pre class="language-text"><code>1. Modify Models/Entities to be postgres compatible . Eg using SEQUENCE generation type IDs
   source: https://vladmihalcea.com/jpa-entity-identifier-sequence/
   https://thorben-janssen.com/hibernate-postgresql-5-things-need-know/
   Changing column precision scales from 20 to 16 for Bigdecimals
2. Convert DTOs variables to lower case, postgres converts everything to lower case. Do not use \&quot;xxx\&quot; in sql statements.
3. Replace NVL with coalesce.
4. Replace sysdate() with aws_oracle_ext.sysdate().
5. Cast to BigInteger all select count resultsets and single column results whose datatype is bigint, same to any other datatype else will throw an error.
6. Replace all `hibernate_sequence.nextval` with nextval('hibernate_sequence').
7. Replace list_agg with string_agg.
8. Use appropriate date functions.
9. Check all native queries
10. Cast to BigInteger all select nextval('hibernate_sequence') resultsets
11. All sub-queries must have an alias
12. Use 'yyyy-MM-dd' in to_date() function, and convert all first arguments to string. Use custom function dateformat to achieve this. see examples below
13. Remove force keyword in create view sql

</code></pre></div><h3 id="process"><a href="#process" class="header-anchor">#</a> Process</h3> <ul><li>[x] Set up PostgresSQL Database</li> <li>[x] Set up data sources and persistence</li> <li>[x] Make initial XE deployment</li> <li>[x] Fix the models/entities</li> <li>[x] Redeploy</li> <li>[ ] Migrate Views &amp; Routines</li> <li>[ ] Migrate Native Queries</li> <li>[x] Data Migration, From Oracle cloud to postgres db</li> <li>[ ] Testing</li></ul> <h3 id="webapp-folder"><a href="#webapp-folder" class="header-anchor">#</a> Webapp folder</h3> <div class="language- extra-class"><pre class="language-text"><code>-user_doc
-WEB-INF
-XiManual
-backup.txt
template_instructions.txt
</code></pre></div><h2 id="changes-made-in-code"><a href="#changes-made-in-code" class="header-anchor">#</a> Changes Made In Code</h2> <h3 id="models"><a href="#models" class="header-anchor">#</a> Models</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
<span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">SEQUENCE</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
<span class="token comment">//@Column(name = &quot;spot_rate&quot;, precision=16,scale=20)</span>
<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;spot_rate&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> spotRate<span class="token punctuation">;</span>

<span class="token comment">//DTO</span>
<span class="token comment">//used BigInteger and Long for Ids, all variables in lowercase for mapping using transformers</span>
</code></pre></div><h2 id="native-queries"><a href="#native-queries" class="header-anchor">#</a> Native Queries</h2> <h3 id="update"><a href="#update" class="header-anchor">#</a> UPDATE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- update MEMBERS m set m.EXIT_ID=NULL where m.ID=:memberId and m.EXIT_ID=:exitId and m.MBSHIP_STATUS='ACTIVE';</span>
<span class="token keyword">update</span> MEMBERS m
<span class="token keyword">set</span> EXIT_ID<span class="token operator">=</span><span class="token boolean">NULL</span>
<span class="token keyword">where</span> m<span class="token punctuation">.</span>ID <span class="token operator">=</span> :memberId
  <span class="token operator">and</span> m<span class="token punctuation">.</span>EXIT_ID <span class="token operator">=</span> :exitId
  <span class="token operator">and</span> m<span class="token punctuation">.</span>MBSHIP_STATUS <span class="token operator">=</span> <span class="token string">'ACTIVE'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="select"><a href="#select" class="header-anchor">#</a> SELECT</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select m.MBSHIP_STATUS status, mb.GENDER gender from members m INNER JOIN MEMBERS_BIOS mb on m.MEMBERBIO_ID = mb.ID where m.ID=7165;</span>
<span class="token keyword">select</span> m<span class="token punctuation">.</span>MBSHIP_STATUS <span class="token keyword">AS</span> <span class="token keyword">status</span><span class="token punctuation">,</span> mb<span class="token punctuation">.</span>GENDER <span class="token keyword">AS</span> gender
<span class="token keyword">from</span> members m
         <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> MEMBERS_BIOS mb <span class="token keyword">on</span> m<span class="token punctuation">.</span>MEMBERBIO_ID <span class="token operator">=</span> mb<span class="token punctuation">.</span>ID
<span class="token keyword">where</span> m<span class="token punctuation">.</span>ID <span class="token operator">=</span> <span class="token number">7165</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hibernate-sequence"><a href="#hibernate-sequence" class="header-anchor">#</a> HIBERNATE SEQUENCE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> nextval<span class="token punctuation">(</span><span class="token string">'hibernate_sequence'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="add-months"><a href="#add-months" class="header-anchor">#</a> ADD MONTHS</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> add_months<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="months-between"><a href="#months-between" class="header-anchor">#</a> MONTHS BETWEEN</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select months_between(:startPeriod,sysdate) </span>
<span class="token keyword">select</span> DATE_PART<span class="token punctuation">(</span><span class="token string">'year'</span><span class="token punctuation">,</span> :startPeriod::<span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token operator">-</span> DATE_PART<span class="token punctuation">(</span><span class="token string">'year'</span><span class="token punctuation">,</span> <span class="token keyword">current_timestamp</span>::<span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token comment">--Returns number of Years</span>
           <span class="token keyword">use</span> months_between<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token keyword">function</span>
Eg <span class="token keyword">select</span> months_between<span class="token punctuation">(</span><span class="token string">'2022-07-29 05:14:48'</span>::<span class="token keyword">date</span><span class="token punctuation">,</span><span class="token keyword">current_date</span>::<span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="date-time"><a href="#date-time" class="header-anchor">#</a> DATE TIME</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- SELECT sysdate</span>
<span class="token keyword">select</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> aws_oracle_ext<span class="token punctuation">.</span>sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="to-date"><a href="#to-date" class="header-anchor">#</a> TO_DATE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'2021-08-26'</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="date-diff-in-days"><a href="#date-diff-in-days" class="header-anchor">#</a> DATE DIFF IN DAYS</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">current_date</span> <span class="token operator">-</span> <span class="token string">'2021-08-01'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> dys<span class="token punctuation">;</span>
<span class="token keyword">select</span> daterange_subdiff<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">,</span> <span class="token string">'2021-08-01'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> dys<span class="token punctuation">;</span>
</code></pre></div><h3 id="last-day"><a href="#last-day" class="header-anchor">#</a> LAST_DAY</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- Created custom function last_day(date)</span>
<span class="token keyword">use</span>
<span class="token keyword">select</span> last_day<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="rownum"><a href="#rownum" class="header-anchor">#</a> ROWNUM</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select  ROWNUM FROM MEMBERS m;</span>
<span class="token keyword">select</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> m<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> MEMBERS m<span class="token punctuation">;</span>
<span class="token comment">-- select  ROWNUM FROM MEMBERS m where rownum=1;</span>
<span class="token keyword">select</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> m<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> MEMBERS m
<span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="nvl"><a href="#nvl" class="header-anchor">#</a> NVL</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select nvl(c.ee, 0);</span>
<span class="token keyword">select</span> <span class="token keyword">coalesce</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>ee<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="instr"><a href="#instr" class="header-anchor">#</a> INSTR</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- select INSTR('xxx.xxx', '.');</span>
<span class="token keyword">select</span> position<span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">in</span> <span class="token string">'xxx.xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="lob"><a href="#lob" class="header-anchor">#</a> LOB</h3> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">//add @Type for postgres to know what type of lob ie ImageType/TextType etc</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token annotation punctuation">@Type</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;org.hibernate.type.TextType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="describe-table"><a href="#describe-table" class="header-anchor">#</a> DESCRIBE TABLE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> table_name<span class="token punctuation">,</span> column_name<span class="token punctuation">,</span> data_type
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span>
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'members'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="list-all-procedures"><a href="#list-all-procedures" class="header-anchor">#</a> LIST ALL PROCEDURES</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> n<span class="token punctuation">.</span>nspname <span class="token keyword">as</span> <span class="token keyword">schema</span><span class="token punctuation">,</span>
       p<span class="token punctuation">.</span>proname <span class="token keyword">as</span> <span class="token keyword">procedure</span>
<span class="token keyword">from</span> pg_proc p
         <span class="token keyword">join</span> pg_namespace n <span class="token keyword">on</span> p<span class="token punctuation">.</span>pronamespace <span class="token operator">=</span> n<span class="token punctuation">.</span>oid
<span class="token keyword">where</span> n<span class="token punctuation">.</span>nspname <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'pg_catalog'</span><span class="token punctuation">,</span> <span class="token string">'information_schema'</span><span class="token punctuation">)</span>
  <span class="token operator">and</span> p<span class="token punctuation">.</span>prokind <span class="token operator">=</span> <span class="token string">'p'</span>
</code></pre></div><h3 id="format-date"><a href="#format-date" class="header-anchor">#</a> FORMAT DATE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> TO_CHAR<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span> :: <span class="token keyword">DATE</span><span class="token punctuation">,</span> <span class="token string">'Mon dd, yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> todate<span class="token punctuation">(</span><span class="token keyword">current_date</span>::<span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'30-Sep-2021'</span><span class="token punctuation">,</span> <span class="token string">'dd-Mon-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> todate<span class="token punctuation">(</span>to_char<span class="token punctuation">(</span><span class="token string">'2021-09-30'</span>::<span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token string">'dd-MON-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> todate<span class="token punctuation">(</span><span class="token string">'30-Sep-2021'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> dateformat<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_date<span class="token punctuation">(</span>to_char<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token string">'dd-Mon-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'dd-Mon-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'2020-08-30'</span>::<span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token string">'dd-Mon-yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> todate<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> date_trunc<span class="token punctuation">(</span><span class="token string">'month'</span><span class="token punctuation">,</span> <span class="token keyword">current_date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> todate<span class="token punctuation">(</span>date_trunc<span class="token punctuation">(</span><span class="token string">'month'</span><span class="token punctuation">,</span> <span class="token keyword">current_date</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_timestamp<span class="token punctuation">(</span><span class="token string">'2022-01-01'</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="error"><a href="#error" class="header-anchor">#</a> ERROR</h3> <ul><li>[x] NonUniqueDiscoveredSqlAliasException: Encountered a duplicated sql alias
<code>sql has more than one column with same name, introduce alias</code></li> <li>[x] Could not resolve PropertyAccess for dateAcquired on class com.systech.fm.dto.accounts.FixedAssetsDto
<code>Find the attribute in the DTO and change to lowercase</code></li></ul> <h2 id="login-user"><a href="#login-user" class="header-anchor">#</a> Login User</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>psql <span class="token parameter variable">-U</span> posgres
<span class="token builtin class-name">pwd</span> <span class="token punctuation">[</span>postgres<span class="token punctuation">]</span>
psql <span class="token parameter variable">-V</span> psql <span class="token punctuation">[</span> psql <span class="token punctuation">(</span>PostgreSQL<span class="token punctuation">)</span> <span class="token number">12.6</span> <span class="token punctuation">]</span>
</code></pre></div><h2 id="import-database"><a href="#import-database" class="header-anchor">#</a> Import Database</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pg_restore <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">--dbname</span><span class="token operator">=</span>fm <span class="token parameter variable">--create</span> <span class="token parameter variable">--verbose</span> c:<span class="token punctuation">\</span>pgbackup<span class="token punctuation">\</span>fm.tar
</code></pre></div><h2 id="run-sql"><a href="#run-sql" class="header-anchor">#</a> Run SQL</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#LOGIN TO PSQL</span>
<span class="token punctuation">\</span>i path_to_sql_file
</code></pre></div><h2 id="import-million-records-faster"><a href="#import-million-records-faster" class="header-anchor">#</a> Import Million Records Faster</h2> <div class="language-postgresql extra-class"><pre class="language-text"><code>create table peopleNames
(
    name  varchar(255),
    sex   varchar(255),
    sex_1 varchar(255),
    count bigint,
    year  bigint
);
--FROM TERMINAL
COPY peopleNames FROM '/path/to/pp-complete.csv' with (format csv, encoding 'utf-8', header false, null '', quote '&quot;');
</code></pre></div><h2 id="split-delimited-string"><a href="#split-delimited-string" class="header-anchor">#</a> Split Delimited String</h2> <div class="language-postgresql extra-class"><pre class="language-text"><code>select unnest(string_to_array('1,2,3,4,5', ',')) as id;
--or
SELECT regexp_split_to_table('1,2,3,4,5', ',') AS ID;
--https://medium.com/swlh/three-routes-convert-comma-separated-column-to-rows-c17c85079ecf
</code></pre></div><h2 id="drop-all-views"><a href="#drop-all-views" class="header-anchor">#</a> Drop All Views</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token string">'DROP VIEW '</span> <span class="token operator">||</span> <span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">' cascade;'</span>
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>views
<span class="token keyword">WHERE</span> table_schema <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--copy and save to file and execute</span>
</code></pre></div><h2 id="show-all-tables-in-schema"><a href="#show-all-tables-in-schema" class="header-anchor">#</a> Show All Tables In Schema</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> table_name
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span>
<span class="token keyword">WHERE</span> table_schema <span class="token operator">=</span> <span class="token string">'public'</span>
  <span class="token operator">and</span> table_name <span class="token operator">like</span> <span class="token string">'act_%'</span><span class="token punctuation">;</span>
<span class="token comment">----------------------------</span>
<span class="token keyword">SELECT</span> <span class="token string">'DROP TABLE '</span> <span class="token operator">||</span> <span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">' cascade;'</span> <span class="token keyword">as</span> qry
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span>
<span class="token keyword">WHERE</span> table_schema <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span>
  <span class="token operator">and</span> table_name <span class="token operator">like</span> <span class="token string">'act_%'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="important-scripts"><a href="#important-scripts" class="header-anchor">#</a> Important Scripts</h2> <div class="language-sql extra-class"><pre class="language-sql"><code>
<span class="token keyword">ALTER</span> SEQUENCE hibernate_sequence RESTART <span class="token keyword">WITH</span> <span class="token number">12879141</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> VIEW_NAME<span class="token punctuation">,</span> OWNER
<span class="token keyword">from</span> all_views
<span class="token keyword">where</span> OWNER <span class="token operator">=</span> <span class="token string">'FM'</span><span class="token punctuation">;</span> <span class="token comment">--ORACLE DB</span>

<span class="token keyword">select</span> viewname
<span class="token keyword">from</span> pg_catalog<span class="token punctuation">.</span>pg_views
<span class="token keyword">where</span> schemaname <span class="token operator">=</span> <span class="token string">'public'</span><span class="token punctuation">;</span> <span class="token comment">--get all views in schema</span>

<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>viewname<span class="token punctuation">)</span>
<span class="token keyword">from</span> pg_catalog<span class="token punctuation">.</span>pg_views
<span class="token keyword">where</span> schemaname <span class="token operator">=</span> <span class="token string">'public'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> pg_terminate_backend<span class="token punctuation">(</span>pg_stat_activity<span class="token punctuation">.</span>pid<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> pg_stat_activity
<span class="token keyword">WHERE</span> pg_stat_activity<span class="token punctuation">.</span>datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> pg_stat_activity
<span class="token keyword">WHERE</span> datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> datname
<span class="token keyword">FROM</span> pg_database<span class="token punctuation">;</span><span class="token comment">--get database names</span>

<span class="token keyword">DELETE</span>
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_database
<span class="token keyword">WHERE</span> datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_tables
<span class="token keyword">WHERE</span> schemaname <span class="token operator">!=</span> <span class="token string">'pg_catalog'</span>
  <span class="token operator">AND</span> schemaname <span class="token operator">!=</span> <span class="token string">'information_schema'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> tablename
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_tables
<span class="token keyword">WHERE</span> schemaname <span class="token operator">!=</span> <span class="token string">'pg_catalog'</span>
  <span class="token operator">AND</span> schemaname <span class="token operator">!=</span> <span class="token string">'information_schema'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="installing-extension"><a href="#installing-extension" class="header-anchor">#</a> Installing Extension</h2> <div class="language-text extra-class"><pre class="language-text"><code>   We will be installing tsm_system_rows extension for quick randomizing rows in a table.
   1.   Download postgres source from [https://www.postgresql.org/ftp/source/]
   2.   Unzip and cd to folder.
   3.   bash# sudo ./configure --without-readline --with-pgconfig=/usr/pgsql-14/bin/pg_config
   4.   bash# make
   5.   cd ./contrib/tsm_system_rows/
   6.   bash# sudo make install
   7.   We need to know where to paste the output, run (CREATE EXTENSION tsm_system_rows;) and note the error path
   8.   Copy tsm_system_rows--1.0.sql &amp;amp; tsm_system_rows.control to [/usr/pgsql-14/share/extension]
   9.   Copy tsm_system_rows.so to [/usr/pgsql-14/lib]
   10.  Lauch psql shell [psql -U postgres]
   11.  psql# create extension tsm_system_rows;
   12.  Test psql# SELECT * FROM my_table TABLESAMPLE SYSTEM_ROWS(100);
   
   Installing pg_cron extension
    git clone https://github.com/citusdata/pg_cron.git
    cd pg_cron
    # Ensure pg_config is in your path, e.g.
    export PATH=/usr/pgsql-11/bin:$PATH
    make &amp;amp;&amp;amp; sudo PATH=$PATH make install
</code></pre></div><h2 id="database-queries"><a href="#database-queries" class="header-anchor">#</a> Database Queries</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token string">'alter table '</span> <span class="token operator">||</span> owner <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> table_name <span class="token operator">||</span> <span class="token string">' disable constraint '</span> <span class="token operator">||</span> constraint_name <span class="token operator">||</span> <span class="token string">';'</span>
<span class="token keyword">from</span> user_constraints<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token string">'alter table '</span> <span class="token operator">||</span> owner <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> table_name <span class="token operator">||</span> <span class="token string">' enable constraint '</span> <span class="token operator">||</span> constraint_name <span class="token operator">||</span> <span class="token string">';'</span>
<span class="token keyword">from</span> user_constraints<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> pg_terminate_backend<span class="token punctuation">(</span>pg_stat_activity<span class="token punctuation">.</span>pid<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> pg_stat_activity
<span class="token keyword">WHERE</span> pg_stat_activity<span class="token punctuation">.</span>datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> pg_stat_activity
<span class="token keyword">WHERE</span> datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> datname
<span class="token keyword">FROM</span> pg_database<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span>
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_database
<span class="token keyword">WHERE</span> datname <span class="token operator">=</span> <span class="token string">'Xe'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_tables
<span class="token keyword">WHERE</span> schemaname <span class="token operator">!=</span> <span class="token string">'pg_catalog'</span>
  <span class="token operator">AND</span> schemaname <span class="token operator">!=</span> <span class="token string">'information_schema'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> tablename
<span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_tables
<span class="token keyword">WHERE</span> schemaname <span class="token operator">!=</span> <span class="token string">'pg_catalog'</span>
  <span class="token operator">AND</span> schemaname <span class="token operator">!=</span> <span class="token string">'information_schema'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="alter-table-columns"><a href="#alter-table-columns" class="header-anchor">#</a> Alter Table Columns</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">with</span> mitables
         <span class="token keyword">as</span> <span class="token punctuation">(</span><span class="token keyword">select</span> unnest<span class="token punctuation">(</span>ARRAY <span class="token punctuation">[</span><span class="token string">'closing_balances'</span><span class="token punctuation">,</span><span class="token string">'BENEFITS'</span><span class="token punctuation">,</span><span class="token string">'BENEFIT_PAYMENTS'</span><span class="token punctuation">,</span><span class="token string">'PROV_BEN_BAL'</span><span class="token punctuation">,</span><span class="token string">'FUND_VALUES'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tb<span class="token punctuation">)</span>
<span class="token keyword">select</span> <span class="token string">'alter table '</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">select</span> tb <span class="token keyword">from</span> mitables <span class="token keyword">where</span> lower<span class="token punctuation">(</span>tb<span class="token punctuation">)</span> <span class="token operator">=</span> table_name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">' alter column '</span> <span class="token operator">||</span> column_name <span class="token operator">||</span>
       <span class="token string">' type numeric(19,10);'</span>
<span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span>
<span class="token keyword">where</span> table_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> lower<span class="token punctuation">(</span>tb<span class="token punctuation">)</span> <span class="token keyword">from</span> mitables<span class="token punctuation">)</span>
  <span class="token operator">and</span> data_type <span class="token operator">=</span> <span class="token string">'numeric'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span>
<span class="token keyword">where</span> table_name <span class="token operator">=</span> <span class="token string">'closing_balances'</span>
  <span class="token operator">and</span> data_type <span class="token operator">=</span> <span class="token string">'numeric'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token string">'update closing_balances set '</span> <span class="token operator">||</span> column_name <span class="token operator">||</span> <span class="token string">'=0 where '</span> <span class="token operator">||</span> column_name <span class="token operator">||</span> <span class="token string">' is null and id=1283097;'</span>
<span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span>
<span class="token keyword">where</span> table_name <span class="token operator">=</span> <span class="token string">'closing_balances'</span>
  <span class="token operator">and</span> data_type <span class="token operator">=</span> <span class="token string">'numeric'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="reset-database-notifications"><a href="#reset-database-notifications" class="header-anchor">#</a> Reset Database Notifications</h2> <div class="language-SQL extra-class"><pre class="language-sql"><code>  <span class="token keyword">update</span> SCHEMES
  <span class="token keyword">set</span> EMAIL<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
      SECONDARY_EMAIL<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
      FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
      SECONDARY_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
      ALLOW_NOTIFICATIONS<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">;</span>

<span class="token comment">-- schemenames</span>

<span class="token keyword">update</span> SPONSORS
<span class="token keyword">set</span> EMAIL<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    SECONDARY_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> COMPANIES
<span class="token keyword">set</span> EMAIL<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    SECONDARY_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">;</span>

<span class="token comment">-- member names</span>

<span class="token keyword">update</span> MEMBERS_BIOS
<span class="token keyword">SET</span> CELL_PHONE<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>lower<span class="token punctuation">(</span>FIRSTNAME<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">coalesce</span><span class="token punctuation">(</span>SURNAME<span class="token punctuation">,</span> FIRSTNAME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    PIN<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    ID_NO<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">;</span>


<span class="token keyword">update</span> NOTIFICATION_CONFIGS
<span class="token keyword">set</span> benefitpaymentappr<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    benefitpaymentcert<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    benefitpaymentpost<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    claimapproval<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    claimauthorization<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    claimcancellation<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    claimcertification<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    claiminitialization<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    claimmissingdocs<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    claimprocessingtoacc<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    contributionbilling<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    contributionposting<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    contributionreceipting<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    endorsementapproval<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    endorsementrejection<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    isglobal<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    memberapproval<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    memberauthorization<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    memberbioupdate<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    memberbirthday<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    membercertification<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    membercreation<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    onetimemiscellaneousmsg<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    reserveinflow<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    reserveoutflow<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    retirementcontributionsauthorization<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    retirementcontributionsprocessing<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    schemecreation<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    sponsorcontrreminder<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    sponsorcontrwithoutschedule<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    sponsoronmemberapproval<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    straighttobankpush<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    straighttobankrollback<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    contributionsponsorposting<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    deathinretirement<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    eventsdocuments<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    eventsreminder<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    eventsupdate<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    generationofcoe<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    pensionarrears<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    pensiondeduction<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    pensionrevisionapproval<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    pensionrevisioncertification<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    pensionerapproval<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    pensionerreinstatement<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    pensionersuspension<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    retirementnotification<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    sendnotificationonfirstdeclaredbalancerun<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    usesecondaryemailforclaimrelatednotification<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    docsexpiry<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    eventdeclination<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    exitoptionform<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    hremail<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    hrretirementnotification<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    member_ben_creation<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    member_ben_update<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    membersnotcontributedinawhile<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    allow_notification_to_scheme<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    ret_contr_authorization<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    ret_contrs_proc<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    declared_bal_not<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    trusteelicenseexpiry<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    secondary_email_claim_not<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    withoutnominatedbeneficiary<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    membermerger<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    members_not_cont_dea<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    transfervalueoptionform<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">;</span>

<span class="token comment">-- minor names</span>

<span class="token keyword">update</span> MINORS
<span class="token keyword">SET</span> CELL_PHONE<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>lower<span class="token punctuation">(</span>FIRST_NAME<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">coalesce</span><span class="token punctuation">(</span>SURNAME<span class="token punctuation">,</span> FIRST_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> SERVICE_PROVIDERS
<span class="token keyword">SET</span> CELL_PHONE<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>lower<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">coalesce</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> ACCOUNTNUMBER<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> CUSTODIANS
<span class="token keyword">SET</span> CELL_PHONE<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>lower<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> banks
<span class="token keyword">SET</span> CELL_PHONE<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>lower<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> PRINCIPAL_OFFICERS
<span class="token keyword">SET</span> CELL_PHONE<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> USERS
<span class="token keyword">SET</span> MOBILE_NUMBER<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
    EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>FIRSTNAME<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> SMTP_MAIL_SETUP
<span class="token keyword">set</span> ALLOWNOTIFICATIONS<span class="token operator">=</span><span class="token string">'NO'</span><span class="token punctuation">,</span>
    SMTP_AUTH_USER<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    SENDING_EMAIL<span class="token operator">=</span><span class="token string">'bursting.reports@gmail.com'</span><span class="token punctuation">,</span>
    SMTP_AUTH_PWD<span class="token operator">=</span><span class="token string">'some_pwd'</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> ESTATE_MANAGERS
<span class="token keyword">SET</span> CELL_PHONE<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">update</span> BENEFICIARIES
<span class="token keyword">SET</span> CELL_PHONE<span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
    FIXED_PHONE<span class="token operator">=</span><span class="token boolean">null</span><span class="token punctuation">,</span>
    EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>FIRSTNAME<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SECONDARY_EMAIL<span class="token operator">=</span>concat<span class="token punctuation">(</span>lower<span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span>FIRSTNAME<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'@mailinator.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">delete</span>
<span class="token keyword">from</span> MAILS<span class="token punctuation">;</span>
<span class="token keyword">delete</span>
<span class="token keyword">from</span> SMSES<span class="token punctuation">;</span>

<span class="token keyword">commit</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="backup"><a href="#backup" class="header-anchor">#</a> Backup</h2> <h3 id="all-commands"><a href="#all-commands" class="header-anchor">#</a> All Commands</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> testdb <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token operator">&gt;</span> dump<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>.sql
		pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> fundmaster <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token operator">&gt;</span> backup/fundmaster<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>.sql
Import	<span class="token builtin class-name">:</span>	psql <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> xe <span class="token parameter variable">-a</span> <span class="token parameter variable">-f</span> myInsertFile
		<span class="token punctuation">\</span>i dump.sql

Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> xe <span class="token parameter variable">-v</span> <span class="token parameter variable">--format</span><span class="token operator">=</span>t <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">--encoding</span><span class="token operator">=</span>UTF-8 <span class="token operator">&gt;</span> dump<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>.tar
Import	<span class="token builtin class-name">:</span>	pg_restore <span class="token parameter variable">-c</span> <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> pacific <span class="token parameter variable">-v</span> ./aws-schemas.tar <span class="token parameter variable">-W</span>

		-- Large Databases
Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-U</span> username <span class="token parameter variable">-j</span> num <span class="token parameter variable">-F</span> d <span class="token parameter variable">-f</span> out.dir dbname <span class="token parameter variable">-v</span>
		pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">10</span> <span class="token parameter variable">-F</span> d <span class="token parameter variable">-f</span> ./nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span> nassitdb <span class="token parameter variable">-v</span>
Import	<span class="token builtin class-name">:</span>	pg_restore <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">10</span> <span class="token parameter variable">-d</span> nassitdb ./nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span> <span class="token parameter variable">-v</span>

Export	<span class="token builtin class-name">:</span>	pg_dump dbname <span class="token operator">|</span> <span class="token function">gzip</span> <span class="token operator">&gt;</span> filename.gz
Import	<span class="token builtin class-name">:</span>	gunzip <span class="token parameter variable">-c</span> filename.gz <span class="token operator">|</span> psql dbname

Export	<span class="token builtin class-name">:</span>	pg_dump dbname <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 2G - filename
Import	<span class="token builtin class-name">:</span>	<span class="token function">cat</span> filename* <span class="token operator">|</span> psql dbname

Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-Fc</span> dbname <span class="token operator">&gt;</span> filename
Import	<span class="token builtin class-name">:</span>	pg_restore <span class="token parameter variable">-d</span> dbname filename

		-- Large Databases
Export	<span class="token builtin class-name">:</span>	pg_dump <span class="token parameter variable">-U</span> username <span class="token parameter variable">-v</span> <span class="token parameter variable">-Fc</span> dbname <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 2G - filename
		pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-v</span> <span class="token parameter variable">-Fc</span> nassitdb <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 5G - nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>
Import	<span class="token builtin class-name">:</span>	pg_restore <span class="token parameter variable">-j</span> <span class="token number">8</span> <span class="token parameter variable">-d</span> dbname filename <span class="token parameter variable">-v</span>
</code></pre></div><h3 id="favourite-commands"><a href="#favourite-commands" class="header-anchor">#</a> Favourite Commands</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>-- Fast
pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">10</span> <span class="token parameter variable">-F</span> d <span class="token parameter variable">-f</span> ./nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span> nassitdb <span class="token parameter variable">-v</span>
pg_restore <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">8</span> <span class="token parameter variable">-d</span> nassitdb ./nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span> <span class="token parameter variable">-v</span>

-- Slower
pg_dump <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-v</span> <span class="token parameter variable">-Fc</span> nassitdb <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 5G - nassitdb<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>
pg_restore <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-j</span> <span class="token number">8</span> <span class="token parameter variable">-d</span> nassitdb nassitdump <span class="token parameter variable">-v</span>
</code></pre></div><h2 id="remote-connection"><a href="#remote-connection" class="header-anchor">#</a> Remote Connection</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>psql <span class="token parameter variable">-h</span> <span class="token number">3.7</span>.212.215 <span class="token parameter variable">-p</span> <span class="token number">5432</span> <span class="token parameter variable">-d</span> fundmaster <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-W</span> 
</code></pre></div><h2 id="creating-a-cluster"><a href="#creating-a-cluster" class="header-anchor">#</a> Creating A Cluster</h2> <p>Switch to user postgres</p> <div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token function">sudo</span> <span class="token function">su</span> - postgres
</code></pre></div><p>Create a data directory to store cluster db files</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token operator">&lt;</span>YOUR_FOLDER_NAME<span class="token operator">&gt;</span>
</code></pre></div><p>Initialize the database cluster</p> <div class="language-bash extra-class"><pre class="language-bash"><code>initdb <span class="token parameter variable">-D</span> <span class="token operator">&lt;</span>YOUR_FOLDER_NAME<span class="token operator">&gt;</span>
</code></pre></div><p>Edit configuration files</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>YOUR_FOLDER_NAME<span class="token operator">&gt;</span>
</code></pre></div><p>Edit <span style="color:orangered;"><i>postgresql.conf</i></span></p> <blockquote><p>localhost: '*'</p></blockquote> <blockquote><p>port : &lt;YOUR_PORT&gt;</p></blockquote> <p>Edit <span style="color:orangered;"><i>pg_hba.conf</i></span></p> <blockquote><p>Edit to match your desired configurations</p></blockquote> <p>Start the cluster</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pg_ctl <span class="token parameter variable">-D</span> <span class="token operator">&lt;</span>YOUR_FOLDER_NAME<span class="token operator">&gt;</span> <span class="token parameter variable">-l</span> logfile start
</code></pre></div><p>Stop the cluster</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pg_ctl <span class="token parameter variable">-D</span> <span class="token operator">&lt;</span>YOUR_FOLDER_NAME<span class="token operator">&gt;</span> <span class="token parameter variable">-m</span> immediate stop
</code></pre></div><h2 id="streaming-replication-v14"><a href="#streaming-replication-v14" class="header-anchor">#</a> Streaming Replication v14</h2> <p>We need two servers i.e Master &amp; Slave.</p> <h3 id="master-server"><a href="#master-server" class="header-anchor">#</a> MASTER SERVER</h3> <p>Create Replication user</p> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token keyword">CREATE</span> ROLE replicator <span class="token keyword">WITH</span> LOGIN NOSUPERUSER NOCREATEDB NOCREATEROLE NOINHERIT <span class="token keyword">REPLICATION</span> CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span> PASSWORD <span class="token string">'Qwerty123'</span><span class="token punctuation">;</span>
</code></pre></div><p>Edit <span style="color:orangered;"><i>postgresql.conf</i></span></p> <blockquote>
  wal_level = replica <br>
  max_wal_senders = 100
</blockquote> <p>Edit <span style="color:orangered;"><i>pg_hba.conf</i></span></p> <blockquote>
  host replication all <span style="color:deepskyblue;">slave_ip_address/32 </span> trust <br>
  host replication replicator <span style="color:deepskyblue;">slave_ip_address/32 </span> trust
</blockquote> <p>Restart the postgres service.</p> <h3 id="slave-server"><a href="#slave-server" class="header-anchor">#</a> SLAVE SERVER</h3> <p>Create a directory.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> /app/postgresql/pgdatabase/data
</code></pre></div><p>Now transfer data from master to slave.</p> <code>
pg_basebackup -h <span style="color:orangered;">master_ip</span> -U replicator -D /app/postgresql/pgdatabase/data --write-recovery-conf --progress --verbose
</code> <p>Assign the postgres owner of all migrated directories</p> <code>
  chmod -R 0700 /app/postgresql/pgdatabase/data 
</code> <p>Launching a replica and checking the replication status.</p> <p><code>pg_ctl start /app/postgresql/pgdatabase/data</code></p> <p>How to stop</p> <p><code>pg_ctl -D /var/lib/pgsql/9.6/data -m immediate stop</code></p> <p>If error change permissions as below</p> <p>Change directory user and group.</p> <code>
  chown <span style="color:deepskyblue;">user</span> <span style="color:#77bc71;">/var/run/folderName</span></code> <br> <code>  
  chgrp <span style="color:deepskyblue;">user</span> <span style="color:#77bc71;">/var/run/folderName</span></code> <h3 id="confirm"><a href="#confirm" class="header-anchor">#</a> CONFIRM</h3> <p>On the Master Server run :</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> application_name<span class="token punctuation">,</span> state<span class="token punctuation">,</span> sent_lsn<span class="token punctuation">,</span> write_lsn<span class="token punctuation">,</span> sync_state
<span class="token keyword">from</span> pg_stat_replication<span class="token punctuation">;</span>
</code></pre></div><h2 id="master-to-master-replication-v16"><a href="#master-to-master-replication-v16" class="header-anchor">#</a> Master-to-Master Replication v16</h2> <p>To achieve Multi-master asynchronous replication using Bucardo</p> <blockquote><p><a href="https://bucardo.org/Bucardo/" target="_blank" rel="noopener noreferrer">Bucardo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: is an asynchronous PostgreSQL replication system, allowing for multi-source,
multi-target operations. It was developed at Backcountry by Jon Jensen and Greg Sabino Mullane of End Point Corporation,
and is now in use at many other organizations. Bucardo is free and open source software released under the BSD license.</p></blockquote> <h3 id="references"><a href="#references" class="header-anchor">#</a> References:</h3> <ol><li><a href="https://medium.com/@logeshmohan/postgresql-replication-using-bucardo-5-4-1-6e78541ceb5e" target="_blank" rel="noopener noreferrer">PostgreSQL Replication<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://bucardo.org/Bucardo/installation/" target="_blank" rel="noopener noreferrer">Bucardo Installation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h3 id="requirements"><a href="#requirements" class="header-anchor">#</a> Requirements</h3> <p>This tutorial was implemented in Fedora 39</p> <ol><li>Two or more database cluster</li> <li>Bucardo</li></ol> <h3 id="setup-database"><a href="#setup-database" class="header-anchor">#</a> Setup Database</h3> <p>This assumes Postgres was compiled with Perl support. Install Perl</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> perl-devel
</code></pre></div><p>Create Extension in template1 postgres database</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTENSION plperl<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">LANGUAGE</span> plperlu<span class="token punctuation">;</span>
</code></pre></div><p>Create bucardo user</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> role bucardo superuser login password <span class="token string">'PASSWORD'</span><span class="token punctuation">;</span>
</code></pre></div><p>Create bucardo database using <strong>bucardo</strong> user</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> bucardo<span class="token punctuation">;</span>
</code></pre></div><p>Create <span style="color:orangered;"><i>~/.pgpass</i></span> file</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">touch</span> .pgpass
</code></pre></div><p>Edit the file with following contents:</p> <blockquote><p>127.0.0.1:5432:bucardo:bucardo:&lt;BUCARDO_USER_PASSWORD&gt; <br>
127.0.0.1:5432:*:postgres:&lt;POSTGRES_USER_PASSWORD&gt;</p></blockquote> <p>Edit <span style="color:orangered;"><i>pg_hba.conf</i></span> file, add lines</p> <div class="language-txt extra-class"><pre class="language-txt"><code>local	bucardo		bucardo					    trust
host	bucardo		bucardo		0.0.0.0/0		trust
</code></pre></div><p>Restart postgres service</p> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl restart postgresql-16.service
</code></pre></div><p>Change file permission</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chmod</span> 0600 .pgpass 
</code></pre></div><h3 id="other-installations-fedora-39"><a href="#other-installations-fedora-39" class="header-anchor">#</a> Other Installations (Fedora 39)</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> perl-Pod-Html
<span class="token function">sudo</span> yum <span class="token function">install</span> perl-Test-Simple
<span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> perl-DBI
<span class="token function">sudo</span> yum <span class="token function">install</span> perl-DBD-Pg
<span class="token function">sudo</span> dnf <span class="token function">install</span> postgresql16-plperl
<span class="token function">sudo</span> dnf <span class="token function">install</span> perl-sigtrap
<span class="token function">sudo</span> dnf <span class="token function">install</span> perl-Sys-Hostname
<span class="token function">sudo</span> dnf <span class="token function">install</span> perl-Log-Report-Dispatcher-Syslog
<span class="token function">sudo</span> dnf <span class="token function">install</span> perl-open.noarch
</code></pre></div><h3 id="install-bucardo"><a href="#install-bucardo" class="header-anchor">#</a> Install Bucardo</h3> <p>First we need to install DBIx::Safe. Download it <a href="https://bucardo.org/DBIx-Safe/" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>DBIx::Safe is a Perl module that allows for safe and controlled access to a DBI database handle. It is similar in spirit to the standard Perl module “Safe”. It is used by Bucardo to ensure that custom code does not interfere with the normal running of Bucardo.</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">tar</span> xzf DBIx-Safe-1.2.5.tar.gz
<span class="token builtin class-name">cd</span> DBIx-Safe-1.2.5
perl Makefile.PL
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>Proceed to bucardo installation</p> <blockquote><p>Refer to references section for installation link and documentation. Steps:</p></blockquote> <p>Download latest version of Bucardo <a href="https://bucardo.org/Bucardo/#obtaining-bucardo" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, untar it and switch to the directory:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">tar</span> xzf Bucardo-5.6.0.tar.gz
<span class="token builtin class-name">cd</span> Bucardo-5.6.0
perl Makefile.PL
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>Create this directories</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> /var/run/bucardo/
<span class="token function">sudo</span> <span class="token function">mkdir</span> /var/log/bucardo/
</code></pre></div><p>Install bucardo</p> <div class="language-bash extra-class"><pre class="language-bash"><code>bucardo <span class="token function">install</span>
</code></pre></div><p>You will have an opportunity to change the default parameters:</p> <div class="language-html extra-class"><pre class="language-html"><code>Current connection settings:

1. Host:          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>none</span><span class="token punctuation">&gt;</span></span>
2. Port:          5432
3. User:          postgres
4. Database:      postgres
5. PID directory: /var/run/bucardo 
</code></pre></div><h3 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h3> <blockquote><p>We need a database in both masters with some similar tables:</p></blockquote> <p>Setting Master 1 (SourceDb)</p> <div class="language-sql extra-class"><pre class="language-sql"><code>psql <span class="token operator">-</span>U postgres <span class="token operator">-</span>W
<span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token keyword">clustered</span><span class="token punctuation">;</span>
\c <span class="token keyword">clustered</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> one<span class="token punctuation">(</span>id <span class="token keyword">bigint</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">,</span>num <span class="token keyword">bigint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Repeat for Master 2 (DestDb)</p></blockquote> <p>Setting Bucardo</p> <blockquote><p>Add the databases
Bucardo needs to know about each database it needs to talk to</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>bucardo <span class="token function">add</span> db sourcedb <span class="token assign-left variable">dbhost</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1 <span class="token assign-left variable">dbport</span><span class="token operator">=</span><span class="token number">5432</span> <span class="token assign-left variable">dbname</span><span class="token operator">=</span>clustered <span class="token assign-left variable">user</span><span class="token operator">=</span>postgres <span class="token assign-left variable">dbpass</span><span class="token operator">=</span>postgres

bucardo <span class="token function">add</span> db destdb <span class="token assign-left variable">dbhost</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1 <span class="token assign-left variable">dbport</span><span class="token operator">=</span><span class="token number">5433</span> <span class="token assign-left variable">dbname</span><span class="token operator">=</span>clustered <span class="token assign-left variable">user</span><span class="token operator">=</span>postgres <span class="token assign-left variable">dbpass</span><span class="token operator">=</span>postgres
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>bucardo list dbs
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>bucardo list dbgroups
</code></pre></div><blockquote><p>Add the tables
Bucardo also needs to know about any tables that it may be called on to replicate. (Adding tables by the add table command does not actually start replicating them.)</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>bucardo <span class="token function">add</span> all tables <span class="token parameter variable">--herd</span><span class="token operator">=</span>source_dest <span class="token assign-left variable">db</span><span class="token operator">=</span>sourcedb
bucardo <span class="token function">add</span> all tables <span class="token parameter variable">--herd</span><span class="token operator">=</span>dest_source <span class="token assign-left variable">db</span><span class="token operator">=</span>destdb
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>bucardo list tables
</code></pre></div><blockquote><p>Add the sequences (If exists)</p> <ol><li>Sequences should not be similar to avoid conflict</li> <li><a href="https://bucardo.org/Bucardo/operations/sequences" target="_blank" rel="noopener noreferrer">Best Practices<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>bucardo <span class="token function">add</span> all sequences <span class="token parameter variable">--herd</span><span class="token operator">=</span>source_dest
bucardo <span class="token function">add</span> all sequences <span class="token parameter variable">--herd</span><span class="token operator">=</span>dest_source
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>bucardo list herds
bucardo list relgroups
</code></pre></div><p>Set logging levels</p> <div class="language-bash extra-class"><pre class="language-bash"><code>bucardo <span class="token builtin class-name">set</span> <span class="token assign-left variable">quick_delta_check</span><span class="token operator">=</span><span class="token number">0</span>
bucardo <span class="token builtin class-name">set</span> <span class="token assign-left variable">log_level</span><span class="token operator">=</span>VERBOSE
</code></pre></div><blockquote><p>Add the syncs
A sync is a named replication event. Each sync has a source relgroup.</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>bucardo <span class="token function">add</span> <span class="token function">sync</span> sync_source_dest <span class="token assign-left variable">relgroup</span><span class="token operator">=</span>source_dest <span class="token assign-left variable">db</span><span class="token operator">=</span>sourcedb,destdb
bucardo <span class="token function">add</span> <span class="token function">sync</span> sync_dest_source <span class="token assign-left variable">relgroup</span><span class="token operator">=</span>dest_source <span class="token assign-left variable">db</span><span class="token operator">=</span>destdb,sourcedb
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>bucardo list syncs
</code></pre></div><h3 id="start-bucardo"><a href="#start-bucardo" class="header-anchor">#</a> Start Bucardo</h3> <blockquote><p>The final step is to start the Bucardo service:</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>bucardo start
</code></pre></div><p>Verify that the Bucardo daemons are running</p> <div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token function">ps</span> <span class="token parameter variable">-Afw</span> <span class="token operator">|</span> <span class="token function">grep</span> Bucardo
</code></pre></div><h3 id="test-replication"><a href="#test-replication" class="header-anchor">#</a> Test Replication</h3> <blockquote><p>Insert some records in SourceDb table(s)</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code>    <span class="token keyword">with</span> <span class="token keyword">data</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>
        <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> generate_series<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2000000</span><span class="token punctuation">)</span> <span class="token keyword">as</span> id
    <span class="token punctuation">)</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> one<span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    <span class="token keyword">select</span> id
    <span class="token keyword">from</span> <span class="token keyword">data</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Repeat for DestDb table(s)</p></blockquote> <h3 id="checking-status"><a href="#checking-status" class="header-anchor">#</a> Checking Status</h3> <div class="language-bash extra-class"><pre class="language-bash"><code> bucardo status
</code></pre></div><h3 id="stopping-replication"><a href="#stopping-replication" class="header-anchor">#</a> Stopping Replication</h3> <div class="language-bash extra-class"><pre class="language-bash"><code> bucardo stop
</code></pre></div><h3 id="sample-using-fundmaster-database"><a href="#sample-using-fundmaster-database" class="header-anchor">#</a> Sample using Fundmaster Database</h3> <p>-------------Start Sample----------------------</p> <blockquote><p>Assumes you have already loaded your existing database to both masters</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>bucardo <span class="token function">add</span> db pac_sourcedb <span class="token assign-left variable">dbhost</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1 <span class="token assign-left variable">dbport</span><span class="token operator">=</span><span class="token number">5432</span> <span class="token assign-left variable">dbname</span><span class="token operator">=</span>pacific <span class="token assign-left variable">user</span><span class="token operator">=</span>bucardo <span class="token assign-left variable">dbpass</span><span class="token operator">=</span>bucardo
bucardo <span class="token function">add</span> db pac_destdb <span class="token assign-left variable">dbhost</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1 <span class="token assign-left variable">dbport</span><span class="token operator">=</span><span class="token number">5433</span> <span class="token assign-left variable">dbname</span><span class="token operator">=</span>pacific <span class="token assign-left variable">user</span><span class="token operator">=</span>bucardo <span class="token assign-left variable">dbpass</span><span class="token operator">=</span>bucardo
bucardo <span class="token function">add</span> all tables <span class="token parameter variable">--herd</span><span class="token operator">=</span>pac_source_dest <span class="token assign-left variable">db</span><span class="token operator">=</span>pac_sourcedb
bucardo <span class="token function">add</span> all tables <span class="token parameter variable">--herd</span><span class="token operator">=</span>pac_dest_source <span class="token assign-left variable">db</span><span class="token operator">=</span>pac_destdb
</code></pre></div><blockquote><p>Remove tables without Primary Key</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">with</span> mytables <span class="token keyword">as</span> <span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> table_schema <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> table_name <span class="token keyword">as</span> tbName
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span>
<span class="token keyword">WHERE</span>
<span class="token punctuation">(</span>table_catalog<span class="token punctuation">,</span> table_schema<span class="token punctuation">,</span> table_name<span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> table_catalog<span class="token punctuation">,</span> table_schema<span class="token punctuation">,</span> table_name
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints
<span class="token keyword">WHERE</span> constraint_type <span class="token operator">=</span> <span class="token string">'PRIMARY KEY'</span><span class="token punctuation">)</span> <span class="token operator">AND</span>
table_schema <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'information_schema'</span><span class="token punctuation">,</span> <span class="token string">'pg_catalog'</span><span class="token punctuation">,</span> <span class="token string">'pgq'</span><span class="token punctuation">,</span> <span class="token string">'londiste'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">select</span> <span class="token string">'bucardo remove table '</span><span class="token operator">||</span> m<span class="token punctuation">.</span>tbName<span class="token operator">||</span> <span class="token string">' db=pac_sourcedb'</span> <span class="token keyword">from</span> mytables m
<span class="token keyword">union</span> <span class="token keyword">all</span> 
<span class="token keyword">select</span> <span class="token string">' bucardo remove table '</span><span class="token operator">||</span> m<span class="token punctuation">.</span>tbName<span class="token operator">||</span> <span class="token string">' db=pac_destdb'</span> <span class="token keyword">from</span> mytables m<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Run the generated scripts above in bash</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>bucardo remove table public.fmxi_lv <span class="token assign-left variable">db</span><span class="token operator">=</span>pac_sourcedb
bucardo remove table public.fmxi_lv <span class="token assign-left variable">db</span><span class="token operator">=</span>pac_destdb

bucardo validate all
bucardo reload

bucardo list herds

bucardo <span class="token function">add</span> <span class="token function">sync</span> pac_source_dest_sync <span class="token assign-left variable">relgroup</span><span class="token operator">=</span>pac_source_dest <span class="token assign-left variable">db</span><span class="token operator">=</span>pac_sourcedb,pac_destdb

bucardo <span class="token function">add</span> <span class="token function">sync</span> pac_dest_source_sync <span class="token assign-left variable">relgroup</span><span class="token operator">=</span>pac_dest_source <span class="token assign-left variable">db</span><span class="token operator">=</span>pac_destdb,pac_sourcedb
</code></pre></div><h3 id="dealing-with-sequences"><a href="#dealing-with-sequences" class="header-anchor">#</a> Dealing with Sequences</h3> <p>Replicating sequences can be difficult, to avoid that:</p> <blockquote><p>Update sequences to start at a value less 1 the other and increment by 2</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- master 1 database</span>
<span class="token keyword">alter</span> sequence hibernate_sequence <span class="token keyword">start</span> <span class="token number">1</span> increment <span class="token number">2</span> <span class="token keyword">no</span> maxvalue <span class="token punctuation">;</span>

<span class="token comment">-- master 2 database</span>
<span class="token keyword">alter</span> sequence hibernate_sequence <span class="token keyword">start</span> <span class="token number">2</span> increment <span class="token number">2</span> <span class="token keyword">no</span> maxvalue <span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Having more than 2 masters complicates the problem further 🤔</p></blockquote> <p>-------------End Sample----------------------
</p><hr><p></p> <h2 id="load-balancing"><a href="#load-balancing" class="header-anchor">#</a> Load Balancing</h2> <blockquote><p>Load balancing refers to efficiently distributing incoming network traffic across a group of backend servers, also known as a server farm or server pool. The aim to achieve a load balancer for postgreSQL cluster with multimaster and slave databases.</p></blockquote> <h3 id="_1-haproxy"><a href="#_1-haproxy" class="header-anchor">#</a> 1. HAProxy</h3> <blockquote><p><a href="https://www.haproxy.org/" target="_blank" rel="noopener noreferrer">HAProxy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a free, very fast and reliable reverse-proxy offering high availability, load balancing, and proxying for TCP and HTTP-based applications.</p></blockquote> <h3 id="references-2"><a href="#references-2" class="header-anchor">#</a> References:</h3> <ol><li><a href="https://www.haproxy.com/blog/haproxy-configuration-basics-load-balance-your-servers" target="_blank" rel="noopener noreferrer">Official Site<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.youtube.com/watch?v=k4if9Ywht8U" target="_blank" rel="noopener noreferrer">Youtube<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <blockquote><p>This tutorial was implemented in Fedora 39 on a master-slave unidirectional replica</p></blockquote> <h3 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h3> <p>There are 2 ways for installing:</p> <ol><li><a href="http://www.haproxy.org/download/2.9/src/haproxy-2.9.5.tar.gz" target="_blank" rel="noopener noreferrer">Using source packages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Using native libraries</li></ol> <blockquote><p>We will be using native libraries</p></blockquote> <h3 id="process-2"><a href="#process-2" class="header-anchor">#</a> Process</h3> <p>Install HAProxy</p> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> haproxy
</code></pre></div><p>Setting up HAProxy for your server</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span>  <span class="token parameter variable">-p</span> /etc/haproxy
<span class="token function">mkdir</span>  <span class="token parameter variable">-p</span> /var/lib/haproxy
<span class="token function">touch</span> /var/lib/haproxy/stats
</code></pre></div><p>create a service</p> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl <span class="token builtin class-name">enable</span> haproxy.service
</code></pre></div><p>Add User</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">useradd</span> <span class="token parameter variable">-r</span> haproxy
haproxy <span class="token parameter variable">-v</span>
<span class="token builtin class-name">cd</span> /etc/haproxy/
</code></pre></div><p>Backup config file before your edit</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cp</span> haproxy.cfg haproxy.cfg.bkp
</code></pre></div><p>Edit configuration file</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vim</span> haproxy.cfg
</code></pre></div><blockquote><p>remove backend static &amp; backend app sections</p></blockquote> <p>Defaults section content</p> <div class="language-text extra-class"><pre class="language-text"><code>defaults
	    mode                    tcp
	    log                     global
	    option                  tcplog
	    option                  dontlognull
	    option                  http-server-close
	    option                  redispatch
	    retries                 3
	    timeout http-request    10s
	    timeout queue           1m
	    timeout connect         10s
	    timeout client          1m
	    timeout server          1m
	    timeout http-keep-alive 10s
	    timeout check           10s
	    maxconn                 3000
</code></pre></div><p>Changes made</p> <ol><li>mode set to <strong>tcp</strong></li> <li>option                  <strong>tcplog</strong></li> <li>maxconn                 <strong>3000</strong></li></ol> <p>Frontend section content</p> <div class="language-text extra-class"><pre class="language-text"><code>frontend	main
	    mode        tcp
	    bind        *:5000
	    acl readonly.pgsql nbsrv(pgsql) eq 0
	    use_backend readonly.pgsql if readonly.pgsql
	    acl pgsql nbsrv(pgsql) gt 0
	    use_backend pgsql if pgsql
</code></pre></div><blockquote><p>The section is the entry point of request. The proxy listens to port <strong>5000</strong>, for select statements will be sent to readonly backend service and for write operations will be sent to pgsql backend service</p></blockquote> <p>Backend pgsql section content</p> <div class="language-text extra-class"><pre class="language-text"><code>backend pgsql
	    mode        tcp
	    option      tcp-check
	    server  master-db 127.0.0.1:5432 check
</code></pre></div><blockquote><p>Forward request to master server port 5432</p></blockquote> <p>Backend readonly.pgsql section content</p> <div class="language-text extra-class"><pre class="language-text"><code>backend readonly.pgsql
	    mode        tcp
	    option      tcp-check
	    server  slave-db  127.0.0.1:5434 check
</code></pre></div><blockquote><p>Forward request to slave server port 5434</p></blockquote> <h3 id="complete-configuration"><a href="#complete-configuration" class="header-anchor">#</a> Complete configuration</h3> <p>After the editing, the haproxy.cfg should look like below</p> <div class="language-text extra-class"><pre class="language-text"><code>defaults
	    mode                    tcp
	    log                     global
	    option                  tcplog
	    option                  dontlognull
	    option                  http-server-close
	    option                  redispatch
	    retries                 3
	    timeout http-request    10s
	    timeout queue           1m
	    timeout connect         10s
	    timeout client          1m
	    timeout server          1m
	    timeout http-keep-alive 10s
	    timeout check           10s
	    maxconn                 3000

	frontend	main
	    mode        tcp
	    bind        *:5000
	    acl readonly.pgsql nbsrv(pgsql) eq 0
	    use_backend readonly.pgsql if readonly.pgsql
	    acl pgsql nbsrv(pgsql) gt 0
	    use_backend pgsql if pgsql

	backend pgsql
        balance leastconn
	    mode        tcp
	    option      tcp-check
	    server  master-db 127.0.0.1:5432 check

	backend readonly.pgsql
        balance roundrobin
	    mode        tcp
	    option      tcp-check
	    server  slave-db  127.0.0.1:5434 check
</code></pre></div><p>Another sample configuration</p> <div class="language-text extra-class"><pre class="language-text"><code>global
    log         127.0.0.1 local2
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon
    stats socket /var/lib/haproxy/stats mode 660 level admin
    stats timeout 30s
    # utilize system-wide crypto-policies
    ssl-default-bind-ciphers PROFILE=SYSTEM
    ssl-default-server-ciphers PROFILE=SYSTEM

defaults
    mode		    tcp
    log                     global
    option                  tcplog
    option 	            tcpka
    option                  dontlognull
    option	            http-server-close
    option                  redispatch
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 3000

#---------------------------------------------------------------------
# main frontend which proxys to the backends
#---------------------------------------------------------------------

# Frontend for read-only operations
frontend readonly_frontend
    bind *:5001
    mode tcp
    tcp-request content accept if WAIT_END
    tcp-request inspect-delay 1s
    tcp-request content accept if WAIT_END
    acl is_read_only dst_port 5434
    use_backend readonly_backend if is_read_only
    default_backend write_backend

# Frontend for write operations
frontend write_frontend
    bind *:5000
    mode tcp
    tcp-request content accept if WAIT_END
    tcp-request inspect-delay 1s
    tcp-request content accept if WAIT_END
    use_backend write_backend

# Backend for read-only operations
backend readonly_backend
    mode tcp
    balance roundrobin
    server pg_readonly_node1 127.0.0.1:5434 check

# Backend for write operations
backend write_backend
    mode tcp
    balance leastconn
    server pg_write_node1 127.0.0.1:5432 check
    server pg_write_node2 127.0.0.1:5433 check
</code></pre></div><h3 id="finish-configuration"><a href="#finish-configuration" class="header-anchor">#</a> Finish configuration</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>setsebool <span class="token parameter variable">-P</span> haproxy_connect_any <span class="token number">1</span>
systemctl restart haproxy.service
</code></pre></div><p>Check service</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-antp</span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token number">5000</span>
journalctl <span class="token parameter variable">-xeu</span> haproxy.service
</code></pre></div><h3 id="testing-2"><a href="#testing-2" class="header-anchor">#</a> Testing</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>psql <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">5000</span> <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> postgres <span class="token parameter variable">-c</span> <span class="token string">&quot;select setting from pg_settings where name='port'&quot;</span><span class="token punctuation">;</span>
psql <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">5000</span> <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-d</span> postgres <span class="token parameter variable">-c</span> <span class="token string">&quot;select inet_server_addr(), inet_server_port()&quot;</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>We are making the requests to proxy port 5000, we expect it to redirect our request to the servers specified</p></blockquote> <p><strong>Do more tests using pgbench and monitor</strong></p> <hr> <h3 id="_2-pgpool-ii"><a href="#_2-pgpool-ii" class="header-anchor">#</a> 2. PgPool-II</h3> <blockquote><p>Read <a href="https://www.pgpool.net/docs/latest/en/html/runtime-config-load-balancing.html" target="_blank" rel="noopener noreferrer">Reference Guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>Install</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> dnf <span class="token function">install</span> pgpool-II
</code></pre></div><p>Configuration</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/pgpool-II
<span class="token function">cp</span> pgpool.conf.sample pgpool.conf
<span class="token function">vi</span>  pgpool.conf
</code></pre></div><p>Update <strong>pgpool.conf</strong> contents</p> <div class="language-text extra-class"><pre class="language-text"><code>listen_addresses = '*'
port = 9999

pid_file_name = 'pgpool.pid'

backend_hostname0 = 'localhost'
backend_port0 = 5432
backend_weight0 = 0   # send select statements to qreplica
backend_data_directory0 = '/var/lib/pgsql/16/data'
backend_flag0 = 'ALWAYS_PRIMARY'
backend_application_name0 = 'server5432'
                                   
backend_hostname1 = 'localhost'
backend_port1 = 5434
backend_weight1 = 1
backend_data_directory1 = '/var/lib/pgsql/replica'
backend_flag1 = 'ALLOW_TO_FAILOVER'
backend_application_name1 = 'server5434'

health_check_period = 10
load_balance_mode = on

#replication user and password
sr_check_user = 'replicator'
health_check_user = 'replicator'
sr_check_password = 'postgres'
health_check_password = 'postgres'

#comment in production
log_statement = on
log_per_node_statement = on

allow_clear_text_frontend_auth = on
authentication_timeout = 1min
allow_sql_comments = on
ignore_leading_white_space = on

</code></pre></div><p>Test Load Balancing &amp; Read-Write separation</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">su</span> <span class="token operator">&amp;&amp;</span>  pgpool <span class="token parameter variable">-Dn</span>
<span class="token comment"># OR</span>
<span class="token function">sudo</span> <span class="token function">su</span> <span class="token operator">&amp;&amp;</span>  pgpool <span class="token parameter variable">-D</span>
</code></pre></div><p>Start with logfile</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pgpool <span class="token parameter variable">-Dn</span> <span class="token operator">&gt;</span> /var/log/pgpool-II/pgpool.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p>Confirm PgPool is running</p> <div class="language-bash extra-class"><pre class="language-bash"><code>psql <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">9999</span> <span class="token parameter variable">--command</span><span class="token operator">=</span><span class="token string">&quot;SHOW POOL_NODES;&quot;</span>
</code></pre></div><blockquote><p>9999 - PgPool port</p></blockquote> <p>You can also configure PgPool II for connection pooling</p> <blockquote><p>You can use <strong>PgBouncer</strong> instead, read below</p></blockquote> <div class="language-text extra-class"><pre class="language-text"><code>process_management_mode = dynamic
process_management_strategy = gentle
num_init_children = 32
min_spare_children = 1
max_spare_children = 32
max_pool = 32
child_life_time = 1min
</code></pre></div><hr> <h2 id="failover-failback"><a href="#failover-failback" class="header-anchor">#</a> Failover &amp; Failback</h2> <blockquote></blockquote> <h2 id="connection-pooling"><a href="#connection-pooling" class="header-anchor">#</a> Connection Pooling</h2> <blockquote><p>Managing database connections to improve performance and reduce the overhead of database connections.
<a href="https://medium.com/@dmitry.romanoff/using-pgbouncer-to-improve-performance-and-reduce-the-load-on-postgresql-b54b78deb425" target="_blank" rel="noopener noreferrer">Read More<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="pgbouncer"><a href="#pgbouncer" class="header-anchor">#</a> PgBouncer</h3> <p>Installing</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> pgbouncer
</code></pre></div><p><strong>Configuration</strong></p> <p>Open configuration file</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">vi</span> /etc/pgbouncer/pgbouncer.ini
</code></pre></div><blockquote><p>You can configure as shown <a href="https://medium.com/@dmitry.romanoff/using-pgbouncer-to-improve-performance-and-reduce-the-load-on-postgresql-b54b78deb425" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>Authentication</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">select</span> concat<span class="token punctuation">(</span><span class="token string">'&quot;'</span>,usename,<span class="token string">'&quot; &quot;'</span>,passwd,<span class="token string">'&quot;'</span><span class="token punctuation">)</span> from pg_shadow<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Add the query result to <em>userslist.txt</em></p></blockquote> <p>Sample configuration</p> <blockquote><p>This also works with pg-pool</p></blockquote> <div class="language-text extra-class"><pre class="language-text"><code>;; database name = connect string
;;
;; connect string params:
;;   dbname= host= port= user= password=
;;   client_encoding= datestyle= timezone=
;;   pool_size= connect_query=
[databases]

; foodb over unix socket
;foodb =

; redirect bardb to bazdb on localhost
;bardb = host=localhost dbname=bazdb

; access to dest database will go with single user
;forcedb = host=127.0.0.1 port=300 user=baz password=foo client_encoding=UNICODE datestyle=ISO connect_query='SELECT 1'
* = host=127.0.0.1 port=5000 user=postgres password=postgres client_encoding=UNICODE datestyle=ISO connect_query='SELECT 1'

; use custom pool sizes
;nondefaultdb = pool_size=50 reserve_pool_size=10

; fallback connect string
;* = host=testserver

;; Configuration section
[pgbouncer]

;;;
;;; Administrative settings
;;;

logfile = /var/log/pgbouncer/pgbouncer.log
pidfile = /var/run/pgbouncer/pgbouncer.pid

;;;
;;; Where to wait for clients
;;;

; ip address or * which means all ip-s
listen_addr = 127.0.0.1
listen_port = 6432

; unix socket is also used for -R.
; On debian it should be /var/run/postgresql
;unix_socket_dir = /tmp
;unix_socket_mode = 0777
;unix_socket_group =

;;;
;;; Authentication settings
;;;

; any, trust, plain, crypt, md5
auth_type = trust
;auth_file = /8.0/main/global/pg_auth
auth_file = /etc/pgbouncer/userlist.txt

;; Query to use to fetch password from database.  Result
;; must have 2 columns - username and password hash.
;auth_query = SELECT usename, passwd FROM pg_shadow WHERE usename=$1

;;;
;;; Users allowed into database 'pgbouncer'
;;;

; comma-separated list of users, who are allowed to change settings
;admin_users = user2, someadmin, otheradmin

; comma-separated list of users who are just allowed to use SHOW command
;stats_users = stats, root

;;;
;;; Pooler personality questions
;;;

; When server connection is released back to pool:
;   session      - after client disconnects
;   transaction  - after transaction finishes
;   statement    - after statement finishes
pool_mode = transaction

;
; Query for cleaning connection immediately after releasing from client.
; No need to put ROLLBACK here, pgbouncer does not reuse connections
; where transaction is left open.
;
; Query for 8.3+:
;   DISCARD ALL;
;
; Older versions:
;   RESET ALL; SET SESSION AUTHORIZATION DEFAULT
;
; Empty if transaction pooling is in use.
;
server_reset_query = DISCARD ALL


; Whether server_reset_query should run in all pooling modes.
; If it is off, server_reset_query is used only for session-pooling.
;server_reset_query_always = 0

;
; Comma-separated list of parameters to ignore when given
; in startup packet.  Newer JDBC versions require the
; extra_float_digits here.
;
;ignore_startup_parameters = extra_float_digits

;
; When taking idle server into use, this query is ran first.
;   SELECT 1
;
;server_check_query = select 1

; If server was used more recently that this many seconds ago,
; skip the check query.  Value 0 may or may not run in immediately.
;server_check_delay = 30

;; Use &amp;lt;appname - host&gt; as application_name on server.
;application_name_add_host = 0

;;;
;;; Connection limits
;;;

; total number of clients that can connect
max_client_conn = 5000

; default pool size.  20 is good number when transaction pooling
; is in use, in session pooling it needs to be the number of
; max clients you want to handle at any moment
default_pool_size = 20

;; Minimum number of server connections to keep in pool.
;min_pool_size = 0

; how many additional connection to allow in case of trouble
;reserve_pool_size = 5

; if a clients needs to wait more than this many seconds, use reserve pool
;reserve_pool_timeout = 3

; how many total connections to a single database to allow from all pools
;max_db_connections = 50
;max_user_connections = 50

; If off, then server connections are reused in LIFO manner
;server_round_robin = 0

;;;
;;; Logging
;;;

;; Syslog settings
;syslog = 0
;syslog_facility = daemon
;syslog_ident = pgbouncer

; log if client connects or server connection is made
;log_connections = 1

; log if and why connection was closed
;log_disconnections = 1

; log error messages pooler sends to clients
;log_pooler_errors = 1

;; Period for writing aggregated stats into log.
;stats_period = 60

;; Logging verbosity.  Same as -v switch on command line.
;verbose=0

;;;
;;; Timeouts
;;;

;; Close server connection if its been connected longer.
;server_lifetime = 1200

;; Close server connection if its not been used in this time.
;; Allows to clean unnecessary connections from pool after peak.
;server_idle_timeout = 60

;; Cancel connection attempt if server does not answer takes longer.
;server_connect_timeout = 15

;; If server login failed (server_connect_timeout or auth failure)
;; then wait this many second.
;server_login_retry = 15

;; Dangerous.  Server connection is closed if query does not return
;; in this time.  Should be used to survive network problems,
;; _not_ as statement_timeout. (default: 0)
;query_timeout = 0

;; Dangerous.  Client connection is closed if the query is not assigned
;; to a server in this time.  Should be used to limit the number of queued
;; queries in case of a database or network failure. (default: 120)
;query_wait_timeout = 120

;; Dangerous.  Client connection is closed if no activity in this time.
;; Should be used to survive network problems. (default: 0)
;client_idle_timeout = 0

;; Disconnect clients who have not managed to log in after connecting
;; in this many seconds.
;client_login_timeout = 60

;; Clean automatically created database entries (via &quot;*&quot;) if they
;; stay unused in this many seconds.
; autodb_idle_timeout = 3600

;; How long SUSPEND/-R waits for buffer flush before closing connection.
;suspend_timeout = 10

;; Close connections which are in &quot;IDLE in transaction&quot; state longer than
;; this many seconds.
;idle_transaction_timeout = 0

;;;
;;; Low-level tuning options
;;;

;; buffer for streaming packets
;pkt_buf = 4096

;; man 2 listen
;listen_backlog = 128

;; Max number pkt_buf to process in one event loop.
;sbuf_loopcnt = 5

;; Maximum Postgres protocol packet size.
;max_packet_size = 2147483647

;; networking options, for info: man 7 tcp

;; Linux: notify program about new connection only if there
;; is also data received.  (Seconds to wait.)
;; On Linux the default is 45, on other OS'es 0.
;tcp_defer_accept = 0

;; In-kernel buffer size (Linux default: 4096)
;tcp_socket_buffer = 0

;; whether tcp keepalive should be turned on (0/1)
;tcp_keepalive = 1

;; following options are Linux-specific.
;; they also require tcp_keepalive=1

;; count of keepaliva packets
;tcp_keepcnt = 0

;; how long the connection can be idle,
;; before sending keepalive packets
;tcp_keepidle = 0

;; The time between individual keepalive probes.
;tcp_keepintvl = 0

;; DNS lookup caching time
;dns_max_ttl = 15

;; DNS zone SOA lookup period
;dns_zone_check_period = 0

;; DNS negative result caching time
;dns_nxdomain_ttl = 15

;;;
;;; Random stuff
;;;

;; Hackish security feature.  Helps against SQL-injection - when PQexec is disabled,
;; multi-statement cannot be made.
;disable_pqexec=0

;; Config file to use for next RELOAD/SIGHUP.
;; By default contains config file from command line.
;conffile

;; Win32 service name to register as.  job_name is alias for service_name,
;; used by some Skytools scripts.
;service_name = pgbouncer
;job_name = pgbouncer

;; Read additional config from the /etc/pgbouncer/pgbouncer-other.ini file
;%include /etc/pgbouncer/pgbouncer-other.ini
</code></pre></div><hr> <h2 id="performance-testing"><a href="#performance-testing" class="header-anchor">#</a> Performance Testing</h2> <blockquote><p>Aim is to use a load testing tool to test postgreSQL database setup</p></blockquote> <h3 id="pgbench"><a href="#pgbench" class="header-anchor">#</a> PgBench</h3> <blockquote><p>A tool shipped together with postgres. Found in <strong>/usr/pgsql-16/bin</strong> directory</p></blockquote> <p>Generate Test Data</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/pgsql-16/bin/pgbench <span class="token parameter variable">-i</span> <span class="token parameter variable">-s</span> <span class="token number">100</span> stressdb <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-p</span> <span class="token number">5432</span>
</code></pre></div><blockquote><p>Use  a scale_factor of 100 to generate data i.e 10M records</p></blockquote> <p>Bench mark database</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/pgsql-16/bin/pgbench <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">5000</span> <span class="token parameter variable">-c</span> <span class="token number">100</span> <span class="token parameter variable">-T</span> <span class="token number">120</span> stressdb <span class="token parameter variable">-U</span> postgres
</code></pre></div><blockquote><p>5000 = database connection port or load balancer binding port, 100 = number of connections 120 - Time in seconds</p></blockquote> <p>Bench mark using threads</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/pgsql-16/bin/pgbench <span class="token parameter variable">-c</span> <span class="token number">100</span> <span class="token parameter variable">-j</span> <span class="token number">2</span> <span class="token parameter variable">-T</span> <span class="token number">120</span>  stressdb <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">5000</span>

/usr/pgsql-16/bin/pgbench <span class="token parameter variable">-c</span> <span class="token number">100</span> <span class="token parameter variable">-t</span> <span class="token number">1000</span> <span class="token parameter variable">-S</span> <span class="token parameter variable">-j</span> <span class="token number">2</span> <span class="token parameter variable">-T</span> <span class="token number">60</span> <span class="token parameter variable">-C</span> <span class="token parameter variable">-f</span> readonly.sql stress <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">5000</span>
</code></pre></div><blockquote><p>2 = number of threads</p></blockquote> <p>Using sql script</p> <blockquote><p>Create a file readonly.sql</p></blockquote> <p>Contents of readonly.sql</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> abalance <span class="token keyword">from</span> pgbench_accounts <span class="token keyword">where</span> aid <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> abalance <span class="token keyword">from</span> pgbench_accounts <span class="token keyword">where</span> aid <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pgbench_tellers  <span class="token keyword">where</span> tid <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pgbench_branches <span class="token keyword">where</span> bid <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> tid <span class="token keyword">from</span> pgbench_history <span class="token keyword">where</span> bid <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>Run the bench mark</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/pgsql-16/bin/pgbench <span class="token parameter variable">-c</span> <span class="token number">100</span> <span class="token parameter variable">-j</span> <span class="token number">2</span> <span class="token parameter variable">-T</span> <span class="token number">60</span> <span class="token parameter variable">-f</span> readonly.sql stress <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">5000</span>
</code></pre></div><hr> <h2 id="good-practices"><a href="#good-practices" class="header-anchor">#</a> Good practices</h2> <div class="language- extra-class"><pre><code>[https://stackoverflow.com/questions/45782327/org-postgresql-util-psqlexception-error-column-user0-id-does-not-exist-hibe](https://stackoverflow.com/questions/45782327/org-postgresql-util-psqlexception-error-column-user0-id-does-not-exist-hibe)
</code></pre></div><ol><li><p>Don't use Upper letters in the name of database, schema, tables or columns in PostgreSQL. Else you should to escape
this names with quotes, and this can cause Syntax errors, so instead you can use :</p> <div class="language- extra-class"><pre><code>@Table(name=&quot;table_name&quot;, schema = &quot;schame_name&quot;)
^^^^^^^^^^             ^^^^^^^^^^^
</code></pre></div></li> <li><p>The keyword USER is reserved keyword in PostgreSQL take a look at</p> <p><strong>+----------+-----------+----------+-----------+---------+
| Key Word |PostgreSQL |SQL:2003 | SQL:1999 | SQL-92 |
+----------+-----------+----------+-----------+---------+
| .... .... .... .... .... |
+----------+-----------+----------+-----------+---------+
| USER | reserved |reserved | reserved | reserved|</strong>
+----------+-----------+----------+-----------+---------+</p></li> <li><p>The difference between Dto and Entity, its good practice to use Entity in the end of the name of your Entity for
example
UserEntity</p></li></ol> <h2 id="important-links"><a href="#important-links" class="header-anchor">#</a> Important Links</h2> <p>https://www.postgresqltutorial.com/
<a href="https://postgrescheatsheet.com/#/tables" target="_blank" rel="noopener noreferrer">https://postgrescheatsheet.com/#/tables<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://medium.com/coding-blocks/creating-user-database-and-adding-access-on-postgresql-8bfcd2f4a91e" target="_blank" rel="noopener noreferrer">https://medium.com/coding-blocks/creating-user-database-and-adding-access-on-postgresql-8bfcd2f4a91e<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
https://www.postgresqltutorial.com/postgresql-reset-password/</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/6/2024, 12:13:17 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database-setup/edb-postgres-guide.html" class="prev">
        EDB Postgres database Setup
      </a></span> <span class="next"><a href="/database-setup/mysql-guide.html">
        MYSQL database Setup
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0205bbfe.js" defer></script><script src="/assets/js/2.51e18b29.js" defer></script><script src="/assets/js/19.4f877263.js" defer></script>
  </body>
</html>
